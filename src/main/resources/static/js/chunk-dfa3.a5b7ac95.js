(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-dfa3"],{"1a/e":function(t,e,i){},kFvY:function(t,e,i){"use strict";i.r(e);var s=i("f0Pt"),a=i.n(s),o=i("KTTK"),n=i("7Qib"),l=i("ViDN"),r=i("utuE"),c=i("1RnH"),m={components:{CreateView:l.a,membersDep:r.a,relatedBusiness:c.a},props:{formData:{type:Object,default:function(){return{}}},dialogTitle:{type:String,default:"写日志"},accessoryFileList:{type:Array,default:function(){return[]}},imgFileList:{type:Array,default:function(){return[]}},newLoading:Boolean},data:function(){return{activeName:"1",tabsData:[{label:"日报",key:"1"},{label:"周报",key:"2"},{label:"月报",key:"3"}],formList:[],dateList:[{label:"今日工作内容",model:"content"},{label:"明日工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],weekList:[{label:"本周工作内容",model:"content"},{label:"下周工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],monthList:[{label:"本月工作内容",model:"content"},{label:"下月工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],batchId:Object(n.i)(),imageFileList:[],fileList:[],dialogVisible:!1,relevanceAll:{},allData:{}}},computed:{crmFileSaveUrl:function(){return o.f},httpHeader:function(){return{"Admin-Token":a.a.defaults.headers["Admin-Token"]}}},mounted:function(){if(document.body.appendChild(this.$el),this.formList=this.dateList,this.formData.categoryId)switch(this.formData.categoryId){case 1:this.tabsData=[{label:"日报",key:"1"}],this.formList=this.dateList;break;case 2:this.tabsData=[{label:"周报",key:"1"}],this.formList=this.weekList;break;case 3:this.tabsData=[{label:"月报",key:"1"}],this.formList=this.monthList}"写日志"!=this.dialogTitle&&this.formData.batchId&&(this.batchId=this.formData.batchId);var t={};t.business=this.formData.businessList?this.formData.businessList:[],t.contacts=this.formData.contactsList?this.formData.contactsList:[],t.contract=this.formData.contractList?this.formData.contractList:[],t.customer=this.formData.customerList?this.formData.customerList:[],this.allData=t;var e={};e.businessIds=this.formData.businessList?this.formData.businessList.map(function(t,e,i){return t.businessId}):[],e.contactsIds=this.formData.contactsList?this.formData.contactsList.map(function(t,e,i){return t.contactsId}):[],e.contractIds=this.formData.contractList?this.formData.contractList.map(function(t,e,i){return t.contractId}):[],e.customerIds=this.formData.customerList?this.formData.customerList.map(function(t,e,i){return t.customerId}):[],this.relevanceAll=e,this.imageFileList=this.imgFileList.map(function(t,e,i){return t.url=t.filePath,t}),this.fileList=this.accessoryFileList.map(function(t,e,i){return t.url=t.filePath,t})},destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{close:function(){1==this.$route.query.routerKey?this.$router.go(-1):this.$emit("close")},tabClick:function(){switch(this.activeName){case"1":this.formList=this.dateList;break;case"2":this.formList=this.weekList;break;case"3":this.formList=this.monthList}},submitBtn:function(){this.formData.content||this.formData.tomorrow||this.formData.question?this.$emit("submitBtn",this.activeName,this.batchId,this.imageFileList,this.relevanceAll):this.$message.error("内容至少填写一项")},imgFileUploadSuccess:function(t,e,i){this.imageFileList=i},handleFilePreview:function(t){if(t.response||t.fileId){var e=void 0;e=t.response?t.response:{url:t.filePath,name:t.name},this.$bus.emit("preview-image-bus",{index:0,data:[e]})}},beforeRemove:function(t,e){var i=this;if(t.response||t.fileId){var s=void 0;return s=t.response?t.response.fileId:t.fileId,this.$confirm("您确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.c)({id:s}).then(function(t){i.$message.success("操作成功");var e=i.getFileIndex(i.$refs.imageUpload.uploadFiles,s);-1!=e&&i.$refs.imageUpload.uploadFiles.splice(e,1),-1!=(e=i.getFileIndex(i.imgFileList,s))&&i.imgFileList.splice(e,1)}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"已取消操作"})}),!1}return!0},getFileIndex:function(t,e){for(var i=-1,s=0;s<t.length;s++){var a=t[s];if((a.response?a.response.fileId:a.fileId)==e){i=s;break}}return i},fileUploadSuccess:function(t,e,i){this.fileList=i},handleFileRemove:function(t,e){var i=this;if(t.response||t.fileId){var s=void 0;return s=t.response?t.response.fileId:t.fileId,this.$confirm("您确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.c)({id:s}).then(function(t){i.$message.success("操作成功");var e=i.getFileIndex(i.$refs.fileUpload.uploadFiles,s);-1!=e&&i.$refs.fileUpload.uploadFiles.splice(e,1),-1!=(e=i.getFileIndex(i.fileList,s))&&i.fileList.splice(e,1)}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"已取消操作"})}),!1}return!0},popoverSubmit:function(t,e){this.$set(this.formData,"sentWhoList",t),this.$set(this.formData,"depData",e)},handleClose:function(){this.dialogVisible=!1},checkInfos:function(t){this.relevanceAll=t}}},d=(i("l3ki"),i("ZrdR")),f=Object(d.a)(m,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("create-view",{attrs:{"body-style":{height:"100%"}}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.newLoading,expression:"newLoading"}],staticClass:"new-journal"},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"text"},[t._v(t._s(t.dialogTitle))]),t._v(" "),s("img",{staticClass:"el-icon-close rt",attrs:{src:i("cjwK"),alt:""},on:{click:t.close}})]),t._v(" "),s("div",{staticClass:"content"},[s("el-tabs",{on:{"tab-click":t.tabClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabsData,function(t,e){return s("el-tab-pane",{key:e,attrs:{label:t.label,name:t.key}})})),t._v(" "),s("div",{staticClass:"form"},[t._l(t.formList,function(e,i){return s("div",{key:i,staticClass:"row-list"},[s("label",{staticClass:"item-label"},[t._v(t._s(e.label)+"：")]),t._v(" "),s("el-input",{attrs:{autosize:{minRows:4},type:"textarea",placeholder:"请输入内容",resize:"none"},model:{value:t.formData[e.model],callback:function(i){t.$set(t.formData,e.model,i)},expression:"formData[item.model]"}})],1)}),t._v(" "),s("div",{staticClass:"img-accessory"},[s("div",{staticClass:"img-box"},[s("el-upload",{ref:"imageUpload",attrs:{action:t.crmFileSaveUrl,headers:t.httpHeader,data:{type:"img",batchId:t.batchId},"on-preview":t.handleFilePreview,"before-remove":t.beforeRemove,"on-success":t.imgFileUploadSuccess,"file-list":t.imageFileList,name:"file",multiple:"",accept:"image/*","list-type":"picture-card"}},[s("p",{staticClass:"add-img"},[s("span",{staticClass:"el-icon-picture"}),t._v(" "),s("span",[t._v("添加图片")])]),t._v(" "),s("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),s("p",{staticClass:"add-accessory"},[s("el-upload",{ref:"fileUpload",attrs:{action:t.crmFileSaveUrl,headers:t.httpHeader,data:{type:"file",batchId:t.batchId},"on-preview":t.handleFilePreview,"before-remove":t.handleFileRemove,"on-success":t.fileUploadSuccess,"file-list":t.fileList,name:"file",multiple:"",accept:"*.*"}},[s("p",[s("img",{attrs:{src:i("6KEE"),alt:""}}),t._v("\n                添加附件\n              ")])])],1)]),t._v(" "),s("div",{staticClass:"sent-who"},[s("span",{staticClass:"label"},[t._v("发送给谁:")]),t._v(" "),t._l(t.formData.sentWhoList,function(e,i){return s("div",{directives:[{name:"photo",rawName:"v-photo",value:e,expression:"k"},{name:"lazy",rawName:"v-lazy:background-image",value:t.$options.filters.filterUserLazyImg(e.img),expression:"$options.filters.filterUserLazyImg(k.img)",arg:"background-image"}],key:i,staticClass:"div-photo k-img header-circle"})}),t._v(" "),s("span",t._l(t.formData.depData,function(e,i){return s("span",{key:i,staticClass:"item-name"},[t._v(t._s(e.name))])})),t._v(" "),s("members-dep",{attrs:{"user-checked-data":t.formData.sentWhoList,"dep-checked-data":t.formData.depData,"content-block":!1},on:{popoverSubmit:t.popoverSubmit}},[s("img",{staticClass:"sent-img",attrs:{slot:"membersDep",src:i("xVxq")},slot:"membersDep"})])],2),t._v(" "),s("related-business",{attrs:{"margin-left":"0","all-data":t.allData},on:{checkInfos:t.checkInfos}})],2)],1),t._v(" "),s("div",{staticClass:"btn-group"},[s("el-button",{attrs:{type:"primary"},on:{click:t.submitBtn}},[t._v("提交")]),t._v(" "),s("el-button",{on:{click:t.close}},[t._v("取消")])],1)])])},[],!1,null,"716305bc",null);f.options.__file="newDialog.vue";e.default=f.exports},l3ki:function(t,e,i){"use strict";var s=i("1a/e");i.n(s).a}}]);