(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4bf7"],{"+SXF":function(e,t,i){"use strict";var s=i("WOrV");i.n(s).a},"/umX":function(e,t,i){"use strict";t.__esModule=!0;var s=function(e){return e&&e.__esModule?e:{default:e}}(i("9dlP"));t.default=function(e,t,i){return t in e?(0,s.default)(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}},"2z+w":function(e,t,i){},"3gs7":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjcxMEMyOTg1QzBBMzExRThCRjRERkU3Mzg5NDBDQTlCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjcxMEMyOTg2QzBBMzExRThCRjRERkU3Mzg5NDBDQTlCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NzEwQzI5ODNDMEEzMTFFOEJGNERGRTczODk0MENBOUIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NzEwQzI5ODRDMEEzMTFFOEJGNERGRTczODk0MENBOUIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4G5F1NAAAA5UlEQVR42mJctWpVAwMDQyUQszGQBn4CcRMLkKgC4j9AfJZEA7SBuAZkwEUgNgTiTCA+TaRmJyDeA8SHmIBEERCD6NlAzEKEZj4gng/EH4E4EaTxMBAvB2J9IC4hwoB+IJYD4lQgvs8EFSwD4i9AXAfEKng0+wBxEhDPAOI1DFCng8BTIG4FYk6oJCMWzUJQb4LCrBAmyITmtNtA7AzE8VgMmA7EvEAcAcQ/sBnwE8nkDjTNnUAcBsRZQHwDWYIJTeFWKC2OJl4GpRehO4uJgUIwDAzAlnQ3UWqA/4B7gYEUbwEEGAANECY5RBCuPwAAAABJRU5ErkJggg=="},"5hU7":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZDRTM3MDlBRUUzODExRTg4Njk3OTRBOTFDQjJDRjRCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZDRTM3MDlCRUUzODExRTg4Njk3OTRBOTFDQjJDRjRCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkNFMzcwOThFRTM4MTFFODg2OTc5NEE5MUNCMkNGNEIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkNFMzcwOTlFRTM4MTFFODg2OTc5NEE5MUNCMkNGNEIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz52FujQAAAAVklEQVR42mK0a3nJQC44WC3GwMRAISBkwBEgPoxPAQsBA6wpdQHD0DIAFGD/0TAMoIsfptQFjNhiwQaLwv/oGoZhLBBKiUcpNcCGYHT8//+fIi8ABBgA6ZAToBWLB7IAAAAASUVORK5CYII="},Gdfm:function(e,t,i){"use strict";var s=i("ritK");i.n(s).a},HfS2:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZBOTA3QjY4RUUzODExRTg5NkQyQzE5MENDMkUwODZEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZBOTA3QjY5RUUzODExRTg5NkQyQzE5MENDMkUwODZEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkE5MDdCNjZFRTM4MTFFODk2RDJDMTkwQ0MyRTA4NkQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkE5MDdCNjdFRTM4MTFFODk2RDJDMTkwQ0MyRTA4NkQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz77tjJFAAABTElEQVR42qTTzyvEQRjH8V0hbk6r/Ngc2CgnthC2Jc7KKsVfIOtGrbuNoiRaf4FSGzlL2oMD+XHSJvaEhJM9rRvvR5+tOXz3G5l61czOM8/OzDPfYGzlLfCfVuUzl8eX5P+aoBHNaBDrh7wCq53+NlpwizmkUdRcWrvYRTeeseDuIIpJ5FCPPuxgHINK3q+5nGKj7g4yWMeWxsM4RUHjdsxiUeOgkg6UExxiGfsoIYsZJbE2igNEtAuL3XR3sIYYelGHC2dxQP1zjOET11pTsQo1Hr/V+pUxpX+3zCfqx524EfRo7kbzKfcIdqureNV4Cnt40G7akFBZi4qdtmOUE8zjSK+uVfXuxJDmz9CEDTxhCRPuES5VibiqYJeYxLEkdYklxVjs1U89K3xM9pTvEdb4ER1493vKbrOsL/jQ+M5rsV8Ca12/+Zy/BRgAE3dJqM+BEpAAAAAASUVORK5CYII="},J481:function(e,t,i){"use strict";var s=i("fiM3");i.n(s).a},Jf58:function(e,t,i){"use strict";var s=i("gXfz");i.n(s).a},NS7n:function(e,t,i){"use strict";var s={name:"FilterContent",props:{obj:{type:Object,required:!0,default:function(){return{}}}},data:function(){return{optionsNames:{is:"等于",isNot:"不等于",contains:"包含",notContains:"不包含",startWith:"开始于",endWith:"结束于",isNull:"为空",isNotNull:"不为空",eq:"等于",neq:"不等于",gt:"大于",egt:"大于等于",lt:"小于",elt:"小于等于"},showObj:{}}},computed:{},watch:{obj:function(e){this.showObj=e}},mounted:function(){this.showObj=this.obj},methods:{handleDelete:function(e,t){this.$delete(this.showObj.obj,e.fieldName),this.showObj.form.splice(t,1),this.$emit("delete",{item:e,index:t,obj:this.showObj})},getTypesName:function(e){return e.typeId&&e.typeOption.find(function(t){return t.typeId===e.typeId}).name||""},getCheckName:function(e){var t="";return e.setting.forEach(function(i){i.value!==e.value||(t=i.name)}),t},getStatusName:function(e){if(e.statusId){var t=e.statusOption.find(function(t){return t.statusId===e.statusId});return t.name?"-"+t.name:""}return""}}},a=(i("Ua1u"),i("ZrdR")),n=Object(a.a)(s,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrapper"},[i("ul",{staticClass:"list"},e._l(e.showObj.form,function(t,s){return i("li",{key:s,staticClass:"list-item"},["date"==t.formType?i("span",[e._v(e._s(t.name+" “"+t.value[0]+"-"+t.value[1]+"”"))]):"datetime"===t.formType?i("span",[e._v(e._s(t.name+" “"+t.value[0]+"-"+t.value[1]+"”"))]):"business_type"===t.formType?i("span",[e._v(e._s(t.name+" “"+e.getTypesName(t)+e.getStatusName(t)+"”"))]):"map_address"===t.formType?i("span",[e._v(e._s(t.name+" "+t.address.state+" "+t.address.city+" "+t.address.area))]):"checkStatus"===t.formType?i("span",[e._v(e._s(t.name+" “"+e.optionsNames[t.condition]+"” "+e.getCheckName(t)))]):"user"===t.formType?i("span",[e._v(e._s(t.name+" "+e.optionsNames[t.condition]+"“"+t.value[0].realname+"”"))]):"category"===t.formType&&t.value.length>0?i("span",[e._v(e._s(t.name+" “"+t.valueContent+"”"))]):i("span",[e._v(e._s(t.name+" "+e.optionsNames[t.condition]+"“"+t.value+"”"))]),e._v(" "),i("i",{staticClass:"el-icon-close icon",on:{click:function(i){e.handleDelete(t,s)}}})])}))])},[],!1,null,"141ba86d",null);n.options.__file="filterContent.vue";t.a=n.exports},P7cU:function(e,t,i){"use strict";var s=i("unkg");i.n(s).a},SgFI:function(e,t,i){"use strict";var s=i("UsYN");i.n(s).a},UFBb:function(e,t,i){"use strict";var s=i("u/aq");i.n(s).a},UXuX:function(e,t,i){},Ua1u:function(e,t,i){"use strict";var s=i("2z+w");i.n(s).a},UsYN:function(e,t,i){},WOrV:function(e,t,i){},Y4AT:function(e,t,i){},bwvB:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdFOTRBNUY2RjEzRTExRThCMzE4RjAyMzQwQTc5RjQ3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjdFOTRBNUY3RjEzRTExRThCMzE4RjAyMzQwQTc5RjQ3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N0U5NEE1RjRGMTNFMTFFOEIzMThGMDIzNDBBNzlGNDciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6N0U5NEE1RjVGMTNFMTFFOEIzMThGMDIzNDBBNzlGNDciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4t60rSAAAAkUlEQVR42mL8//8/AzUBEwOVAQuMsXr1arINCQ0NJdmFOtT0ch0QXwbiepK8jAOADIH5B0Y3kuvCGqghjlC+I5RfQ66BD6CGvIbyX0P5D8j18hIsYq9xiNMuHQ49A0nN2P/JdSHjoPHycyC2IVKvNRC/IJQOU0AFDxBLEGHgUyBOJmTgNiCWpMTLjIO+xAYIMABJgBzD8GiSjgAAAABJRU5ErkJggg=="},ff4y:function(e,t,i){"use strict";var s=i("Y4AT");i.n(s).a},fiM3:function(e,t,i){},gXfz:function(e,t,i){},jJjR:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlFRDNFMUVGRjEzRTExRThBNjFERkQ5M0I1RDI1OUYzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlFRDNFMUYwRjEzRTExRThBNjFERkQ5M0I1RDI1OUYzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OUVEM0UxRURGMTNFMTFFOEE2MURGRDkzQjVEMjU5RjMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OUVEM0UxRUVGMTNFMTFFOEE2MURGRDkzQjVEMjU5RjMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7Zm7p3AAABUklEQVR42qyUwUoCURSGnaGNtFSqdS8ggQS2sPAJ3AzlIhDzAVr4FJIgroMEFyqzKaFlQS0KxIWtxZZCoTvTndN/4x8QOQdnaC58c2fu/c/PnHvPvZbnebEo2455uK77byPHcf56W5k34wXQA9/AY9/juBYnThyCPqiBIQ2O2A853qdOTnnD7B08gjMw35h/AlXQoC4DPrU/NO9d8ABKgpnf5py/p97WDC/AAbgWTKRSMLp9xomGl+AOLAJu7BI0GScapsFLyGp5BSltU5IsDS3N9W+L/RdIaIZTsCcE+WaW8IdmDWdaygNwGjLlLPjQDFugCOIBzeLUtzTDDtekLgRL6dap72hruGJNvfG9An4Eo11wA/LghFr16I0pMidgBG7BMzfMVEEOlMGEuvG2s+ybHoNzXghXNJtx4ypMcxXkclhPv01CNSvqG9uORdx+BRgAmcBOEZLrcDgAAAAASUVORK5CYII="},kegP:function(e,t,i){"use strict";var s=i("EPZ6"),a=i.n(s),n=i("bS4n"),l=i.n(n),c=i("8t5x"),o=i("2qvR"),r=i("EgJF"),d=i("KzkL"),h=i("vG5h"),u=i("5tgW"),m=i("qbf4"),f=i("YrMO"),p=i("8GhS"),v=i("7Qib"),g={name:"CRMImport",components:{XhUserCell:p.p},props:{show:{type:Boolean,default:!1},crmType:{type:String,default:""}},data:function(){return{loading:!1,fieldList:[],config:1,file:{name:""},user:[],stepsActive:1,stepList:[{icon:"wk wk-upload",title:"上传文件",status:"wait"},{icon:"wk wk-data-import",title:"导入数据",status:"wait"},{icon:"wk wk-success",title:"导入完成",status:"wait"}],resultData:null,processData:{count:0,status:""},messageId:null,intervalTimer:null,historyPopoverShow:!1}},computed:l()({},Object(c.b)(["userInfo"]),{crmTypeName:function(){return{customer:"客户",leads:"线索",contacts:"联系人",product:"产品"}[this.crmType]||""},sureTitle:function(){return{1:"立即导入",2:"最小化",3:"确定"}[this.stepsActive]},showCancel:function(){return 2!=this.stepsActive},fieldUniqueInfo:function(){return this.fieldList.filter(function(e){return 1==e.isUnique}).map(function(e){return e.name}).join("/")||"无"}}),watch:{show:function(e){e?(1==this.stepsActive&&this.userInfo&&(this.user=[this.userInfo]),this.getField()):(3==this.stepsActive&&this.resetData(),this.fieldList=[])},stepsActive:function(){this.$emit("status",{1:"wait",2:"process",3:"finish"}[this.stepsActive])}},mounted:function(){},methods:{sureClick:function(){var e=this;1==this.stepsActive?"finish"==this.stepList[0].status?(this.stepList[1].status="process",this.stepsActive=2,this.firstUpdateFile(function(t){e.messageId=t.data,e.secondQueryNum(),e.intervalTimer=setInterval(function(){"end"==e.processData.status?(clearInterval(e.intervalTimer),e.intervalTimer=null,e.thirdQueryResult()):e.secondQueryNum()},2e3)})):this.file.name?"customer"==this.crmType||this.user&&0!=this.user.length||this.$message.error("请选择负责人"):this.$message.error("请选择导入文件"):this.closeView()},firstUpdateFile:function(e){var t=this,i={};i.repeatHandling=this.config,i.file=this.file,i.ownerUserId=this.user.length>0?this.user[0].userId:"";var s={customer:h.g,leads:u.e,contacts:m.e,product:f.e}[this.crmType];this.loading=!0,s(i).then(function(t){e&&e(t)}).catch(function(){e&&e(!1),t.loading=!1})},secondQueryNum:function(){var e=this;Object(d.m)({messageId:this.messageId}).then(function(t){null===t.data?e.processData.status="end":(e.processData.status="",e.processData.count=t.data)}).catch(function(){})},thirdQueryResult:function(){var e=this;Object(d.l)({messageId:this.messageId}).then(function(t){e.loading=!1,e.stepList[1].status="finish",e.stepsActive=3,e.$emit("status","finish"),t&&(e.resultData=t,t.errSize>0?e.stepList[2].status="error":e.stepList[2].status="finish")}).catch(function(){})},downloadErrData:function(){var e=this;this.loading=!0,Object(d.b)({messageId:this.messageId}).then(function(t){Object(v.a)(t),e.loading=!1}).catch(function(){e.loading=!1})},download:function(){(0,{customer:h.d,leads:u.b,contacts:m.b,product:f.b}[this.crmType])().then(function(e){var t=new Blob([e.data],{type:"application/vnd.ms-excel;charset=utf-8"}),i=document.createElement("a"),s=window.URL.createObjectURL(t);i.href=s,i.download=decodeURI(e.headers["content-disposition"].split("filename=")[1])||"",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}).catch(function(){})},selectFile:function(){document.getElementById("importInputFile").click()},uploadFile:function(e){var t=e.target.files[0];this.file=t,e.target.value="",this.getFirstStepStatus()},userSelect:function(e){e.value&&e.value.length>0?this.user=e.value:this.user=[],this.getFirstStepStatus()},getFirstStepStatus:function(){var e=this.file&&this.file.size,t=this.user&&this.user.length>0;"customer"===this.crmType?this.stepList[0].status=e?"finish":"wait":this.stepList[0].status=e&&t?"finish":"wait"},closeView:function(){this.$emit("update:show",!1),this.$emit("close",3==this.stepsActive?"finish":"")},resetData:function(){this.config=1,this.file={name:""},this.user=[],this.stepsActive=1,this.stepList=[{icon:"wk wk-upload",title:"上传文件",status:"wait"},{icon:"wk wk-data-import",title:"导入数据",status:"wait"},{icon:"wk wk-success",title:"导入完成",status:"wait"}],this.resultData=null,this.processData={count:0,status:""},this.messageId=null},getField:function(){var e=this,t={label:o.a[this.crmType]};Object(d.y)(t).then(function(t){e.fieldList=t.data}).catch(function(){})}}},b=(i("SgFI"),i("ZrdR")),y=Object(b.a)(g,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.show,title:"导入"+e.crmTypeName,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{close:e.closeView}},[i("div",{staticClass:"dialog-body"},[1==e.stepsActive?i("div",{staticClass:"step-section"},[i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("一、请按照数据模板的格式准备要导入的数据。"),i("span",{staticClass:"download",on:{click:e.download}},[e._v("点击下载《"+e._s(e.crmTypeName)+"导入模板》")])]),e._v(" "),i("div",{staticClass:"sections__tips"},[e._v("导入文件请勿超过2MB（约10,000条数据）")])]),e._v(" "),i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("二、请选择数据重复时的处理方式（查重规则：【"+e._s(e.fieldUniqueInfo)+"】）")]),e._v(" "),i("div",{staticClass:"sections__tips"},[e._v("查重规则为：添加"+e._s(e.crmTypeName)+"时所需填写的所有唯一字段，当前设置唯一字段为："+e._s(e.fieldUniqueInfo))]),e._v(" "),i("div",{staticClass:"content"},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.config,callback:function(t){e.config=t},expression:"config"}},e._l([{name:"覆盖系统原有数据",value:1},{name:"跳过",value:2}],function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.value}})}))],1)]),e._v(" "),i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("三、请选择需要导入的文件")]),e._v(" "),i("div",{staticClass:"content"},[i("flexbox",{staticClass:"file-select"},[i("el-input",{attrs:{disabled:!0},model:{value:e.file.name,callback:function(t){e.$set(e.file,"name",t)},expression:"file.name"}}),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.selectFile}},[e._v("选择文件")])],1)],1)]),e._v(" "),i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("四、请选择负责人（"+e._s("customer"==e.crmType?"如不选择，导入的客户将进入公海":"必选")+"）")]),e._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"user-cell"},[i("xh-user-cell",{attrs:{value:e.user},on:{"value-change":e.userSelect}})],1)])])]):2==e.stepsActive?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"step-section",attrs:{"element-loading-text":"数据导入中","element-loading-spinner":"el-icon-loading"}}):3==e.stepsActive?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"step-section"},[i("div",{staticClass:"result-info"},[i("i",{staticClass:"wk wk-success result-info__icon"}),e._v(" "),i("p",{staticClass:"result-info__des"},[e._v("数据导入完成")]),e._v(" "),i("p",{staticClass:"result-info__detail"},[e._v("导入总数据"),i("span",{staticClass:"result-info__detail--all"},[e._v(e._s(e.resultData.totalSize))]),e._v("条，导入成功"),i("span",{staticClass:"result-info__detail--suc"},[e._v(e._s(e.resultData.totalSize-e.resultData.errSize))]),e._v("条，导入失败"),i("span",{staticClass:"result-info__detail--err"},[e._v(e._s(e.resultData.errSize))]),e._v("条")]),e._v(" "),e.resultData&&e.resultData.errSize>0?i("el-button",{staticClass:"result-info__btn--err",attrs:{type:"text"},on:{click:e.downloadErrData}},[e._v("下载错误数据")]):e._e()],1)]):e._e(),e._v(" "),i("input",{attrs:{id:"importInputFile",type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"},on:{change:e.uploadFile}})]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-popover",{attrs:{placement:"top",width:"800","popper-class":"no-padding-popover",trigger:"click"},model:{value:e.historyPopoverShow,callback:function(t){e.historyPopoverShow=t},expression:"historyPopoverShow"}}),e._v(" "),i("el-button",{class:{"is-hidden":!e.showCancel},on:{click:e.closeView}},[e._v("取消")]),e._v(" "),e.sureTitle?i("el-button",{attrs:{type:"primary"},on:{click:e.sureClick}},[e._v(e._s(e.sureTitle))]):e._e()],1)])},[],!1,null,"c50f4fdc",null);y.options.__file="CRMImport.vue";var I=y.exports,C=i("UcQx"),k=i("6zBA"),A=i("ooHJ"),w={name:"CRMExport",components:{},props:{show:{type:Boolean,default:!1},crmType:{type:String,default:""},isSeas:{type:Boolean,default:!1},search:{type:String,default:""},scene_id:{type:[Number,String],default:""},filterObj:{type:Object,default:function(){return{}}},exportParams:{type:Object,default:function(){return{}}}},data:function(){return{showDialog:!1,progress:"",error:"",done:!1,cancel:!1,exportQueueIndex:"",tempData:{temp_file:""},sortData:{}}},computed:l()({},Object(c.b)(["userInfo"]),{crmTypeName:function(){return{customer:"客户",leads:"线索",contacts:"联系人",product:"产品"}[this.crmType]||""}}),watch:{show:function(e){var t=this;this.showDialog=e,e?(this.cancel=!1,this.exportInfos(),window.onbeforeunload=function(e){return t.exportInfos({page:-1,temp_file:t.tempData.temp_file}),e}):window.onbeforeunload=null}},mounted:function(){var e=this;this.$bus.off("getSortData"),this.$bus.on("getSortData",function(t){e.sortData=t})},methods:{closeView:function(){this.error="",this.done=!1,this.exportQueueIndex="",this.progress="",this.$emit("close")},beforeClose:function(e){var t=this;this.error||this.done?e():this.$confirm("此操作将终止导出, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.cancel=!0,e()}).catch(function(){})},exportInfos:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=l()({export_queue_index:this.exportQueueIndex,search:this.search},this.exportParams,this.sortData,t);for(var s in this.scene_id&&(i.scene_id=this.scene_id),this.filterObj)i[s]=this.filterObj[s];var a="All";i.ids&&(a="");(this.isSeas?h.l:{customer:h.f,customerAll:h.e,leads:u.d,leadsAll:u.c,contacts:m.d,contactsAll:m.c,product:f.d,productAll:f.c,business:C.d,businessAll:C.c,contract:k.d,contractAll:k.c,receivables:A.c,receivablesAll:A.b}[this.crmType+a])(i).then(function(t){if(-1!==t.data.type.indexOf("json")){var i=new Blob([t.data],{type:"application/json"}),s=new FileReader;s.readAsText(i,"utf-8"),s.onload=function(){var t=JSON.parse(s.result);e.tempData=t.data,t.error?e.error=t.error:(e.exportQueueIndex=t.data.export_queue_index,e.cancel?-1!==t.data.page&&e.exportInfos({page:-1,temp_file:t.data.temp_file}):-2===t.data.page?setTimeout(function(){e.exportInfos({page:1,temp_file:t.data.temp_file})},1e3):t.data.page>0&&(e.exportInfos({page:t.data.page,temp_file:t.data.temp_file}),e.progress=String(t.data.done)+" / "+String(t.data.total)))}}else{e.exportQueueIndex="",e.done=!0;i=new Blob([t.data],{type:"application/vnd.ms-excel;charset=utf-8"});var a=document.createElement("a"),n=window.URL.createObjectURL(i);a.href=n,a.download=decodeURI(t.headers["content-disposition"].split("filename=")[1])||"",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n)}}).catch(function(){})}}},T=(i("+SXF"),Object(b.a)(w,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.showDialog,title:"导出"+e.crmTypeName,"append-to-body":!0,"close-on-click-modal":!1,"before-close":e.beforeClose,"close-on-press-escape":!1,width:"550px"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeView}},[i("div",{staticClass:"dialog-body"},[e.error?i("p",{staticClass:"error",domProps:{textContent:e._s(e.error)}}):e._e(),e._v(" "),e.done?i("p",{staticClass:"done"},[i("i",{staticClass:"el-icon-success"}),e._v("\n      导出已完成\n    ")]):e.cancel?i("p",{staticClass:"cancel"},[i("i",{staticClass:"el-icon-warning"}),e._v("\n      导出已取消\n    ")]):i("div",[i("i",{staticClass:"el-icon-loading"}),e._v("\n      导出中...\n      "+e._s(e.progress)+"\n    ")])]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})])},[],!1,null,"43ac867c",null));T.options.__file="CRMExport.vue";var D=T.exports,_={name:"CRMListHead",components:{CRMCreateView:r.default,CRMImport:I,CRMExport:D},props:{title:{type:String,default:""},placeholder:{type:String,default:"请输入内容"},mainTitle:{type:String,default:""},crmType:{type:String,default:""},isSeas:{type:Boolean,default:!1},search:String,scene_id:{type:[Number,String],default:""},filterObj:{type:Object,default:function(){return{}}}},data:function(){return{inputContent:"",moreTypes:[],createActionInfo:{type:"save"},createCRMType:"",isCreate:!1,showCRMImport:!1,showCRMExport:!1,exportParams:{}}},computed:l()({},Object(c.b)(["crm"]),{canSave:function(){return!this.isSeas&&this.crm[this.crmType].save}}),mounted:function(){this.isSeas?this.crm.pool.excelexport&&this.moreTypes.push({type:"out",name:"导出"}):(this.crm[this.crmType].excelimport&&this.moreTypes.push({type:"enter",name:"导入"}),this.crm[this.crmType].excelexport&&this.moreTypes.push({type:"out",name:"导出"}))},methods:{handleTypeDrop:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("out"==e){var i={};t.__export?delete(i=t).__export:i={},this.exportParams=i,this.showCRMExport=!0}else"enter"==e&&(this.showCRMImport=!0)},createClick:function(){this.createCRMType=this.crmType,this.createActionInfo={type:"save"},this.isCreate=!this.isCreate},inputChange:function(){this.$emit("update:search",this.inputContent)},searchInput:function(){this.$emit("on-search",this.inputContent)},createSaveSuccess:function(e){e&&e.saveAndCreate?"customer"==e.type&&(this.createCRMType="contacts",this.createActionInfo={type:"relative",crmType:"customer",data:{}},this.createActionInfo.data.customer=e.data,this.isCreate=!0):this.$emit("on-handle",{type:"save-success"})},hideView:function(){this.isCreate=!1}}},N=(i("Jf58"),Object(b.a)(_,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"c-container"},[i("div",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),i("el-input",{staticClass:"sc-container",attrs:{placeholder:e.placeholder},on:{input:e.inputChange},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.searchInput(t):null}},model:{value:e.inputContent,callback:function(t){e.inputContent=t},expression:"inputContent"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},nativeOn:{click:function(t){return e.searchInput(t)}},slot:"append"})],1),e._v(" "),i("div",{staticClass:"right-container"},[e.canSave?i("el-button",{attrs:{type:"primary"},on:{click:e.createClick}},[e._v(e._s(e.mainTitle))]):e._e(),e._v(" "),e.moreTypes.length>0?i("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleTypeDrop}},[i("flexbox",{staticClass:"right-more-item"},[i("div",[e._v("更多")]),e._v(" "),i("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{color:"#777"}})]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.moreTypes,function(t,s){return i("el-dropdown-item",{key:s,attrs:{command:t.type}},[e._v(e._s(t.name))])}))],1):e._e()],1),e._v(" "),e.isCreate?i("c-r-m-create-view",{attrs:{"crm-type":e.createCRMType,action:e.createActionInfo},on:{"save-success":e.createSaveSuccess,"hiden-view":e.hideView}}):e._e(),e._v(" "),i("c-r-m-import",{attrs:{show:e.showCRMImport,"crm-type":e.crmType},on:{close:function(t){e.showCRMImport=!1}}}),e._v(" "),i("c-r-m-export",{attrs:{show:e.showCRMExport,"crm-type":e.crmType,search:e.search,scene_id:e.scene_id,"filter-obj":e.filterObj,"is-seas":e.isSeas,"export-params":e.exportParams},on:{close:function(t){e.showCRMExport=!1}}})],1)},[],!1,null,"7104a506",null));N.options.__file="CRMListHead.vue";var R=N.exports,S=i("/umX"),x=i.n(S),E=i("omC7"),j=i.n(E),O=i("oWS4"),M=i("NS7n"),L={name:"SceneList",components:{},props:{crmType:{type:String,default:""}},data:function(){return{sceneSelectId:-1,sceneList:[]}},computed:l()({},Object(c.b)(["crm"])),watch:{},mounted:function(){this.crm[this.crmType].index&&this.getSceneList()},methods:{getSceneList:function(){var e=this;Object(d.s)({type:o.a[this.crmType]}).then(function(t){var i=t.data.filter(function(e,t){return 1===e.isDefault});if(i&&i.length>0){var s=i[0];e.sceneSelectId=s.sceneId,e.$emit("scene",{id:s.sceneId,name:s.name,bydata:s.bydata||""})}else e.sceneSelectId="",e.$emit("scene",{id:"",name:"",bydata:""});e.sceneList=t.data}).catch(function(){e.$emit("scene",{id:"",name:"",bydata:""})})},selectScene:function(e,t){this.sceneSelectId=e.sceneId,this.$emit("scene",{id:e.sceneId,name:e.name,bydata:e.bydata}),this.$emit("hidden-scene")},addScene:function(){this.$emit("scene-handle",{type:"add"})},setScene:function(){this.$emit("scene-handle",{type:"set"})}}},G=(i("P7cU"),Object(b.a)(L,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"scene-container"},[s("div",{staticClass:"scene-list"},e._l(e.sceneList,function(t,i){return s("div",{key:i,staticClass:"scene-list-item",class:{"scene-list-item-select":t.sceneId==e.sceneSelectId},on:{click:function(s){e.selectScene(t,i)}}},[e._v("\n      "+e._s(t.name)+"\n    ")])})),e._v(" "),s("div",[s("flexbox",{staticClass:"handle-button",nativeOn:{click:function(t){return e.addScene(t)}}},[s("img",{staticClass:"handle-button-icon",attrs:{src:i("5hU7")}}),e._v(" "),s("div",{staticClass:"handle-button-name"},[e._v("新建场景")])]),e._v(" "),s("flexbox",{staticClass:"handle-button",nativeOn:{click:function(t){return e.setScene(t)}}},[s("img",{staticClass:"handle-button-icon",attrs:{src:i("HfS2")}}),e._v(" "),s("div",{staticClass:"handle-button-name"},[e._v("管理")])])],1)])},[],!1,null,"1bb238b3",null));G.options.__file="SceneList.vue";var B=G.exports,U=i("JdUh"),F=i.n(U),Z={name:"SceneCreate",components:{XhUserCell:p.p},props:{dialogVisible:{type:Boolean,required:!0,default:!1},fieldList:{type:Array,required:!0,default:function(){return[]}},obj:{type:Object,default:function(){return{}},required:!0},crmType:{type:String,default:""},name:{type:String,default:""},isDefault:{type:Boolean,default:!1},edit_id:{type:String,default:""}},data:function(){return{form:[],visible:!1,showErrors:!1,saveDefault:!1,saveName:null}},watch:{dialogVisible:{handler:function(e){var t=this;if(e){if(this.edit_id){this.form=[];var i=function(e){var i=t.obj.obj[e],s=t.getItem();if(s.fieldName=i.name,s.condition=i.condition,s.formType=i.formType,"date"==i.formType)s.value=[i.start_date,i.end_date];else if("datetime"==i.formType)s.value=[i.start,i.end];else if("business_type"==i.formType){if(s.typeId=i.typeId,s.statusId=i.statusId,s.typeOption=i.setting,i.typeId){var a=i.setting.find(function(e){return e.typeId===i.typeId});s.statusOption=a?a.statusList:[]}}else"user"==i.formType?s.value=i.setting?[i.setting]:[]:(s.setting=i.setting,s.value=i.value);t.form.push(s)};for(var s in this.obj.obj)i(s)}else this.form=Object(v.k)(this.obj.form),0==this.form.length&&this.form.push(this.getItem());this.name?this.saveName=this.name:this.saveName="",this.isDefault?this.saveDefault=this.isDefault:this.saveDefault=!1}this.visible=this.dialogVisible},deep:!0,immediate:!0},form:function(){this.$nextTick(function(){var e=document.getElementById("scene-filter-container");e.scrollTop=e.scrollHeight})}},methods:{getItem:function(){return{fieldName:"",name:"",formType:"",condition:"is",value:"",typeOption:[],statusOption:[],typeId:"",statusId:""}},typeOptionsChange:function(e){if(e.typeId){var t=e.typeOption.find(function(t){return t.typeId===e.typeId});e.statusOption=t.statusList||[]}else e.statusOption=[];e.statusId=""},userValueChange:function(e){e.value.length>0?e.item.value=e.value:e.item.value=[]},calConditionOptions:function(e,t){return"select"==e||"checkbox"==e||"user"==e||"checkStatus"==e?[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1}]:"module"==e||"text"==e||"textarea"==e?[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"notContains",label:"不包含",disabled:!1}]:"floatnumber"==e||"number"==e?[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"notContains",label:"不包含",disabled:!1},{value:"isNull",label:"为空",disabled:!1},{value:"isNotNull",label:"不为空",disabled:!1},{value:"gt",label:"大于",disabled:!1},{value:"egt",label:"大于等于",disabled:!1},{value:"lt",label:"小于",disabled:!1},{value:"elt",label:"小于等于",disabled:!1}]:[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"notContains",label:"不包含",disabled:!1},{value:"startWith",label:"开始于",disabled:!1},{value:"endWith",label:"结束于",disabled:!1},{value:"isNull",label:"为空",disabled:!1},{value:"isNotNull",label:"不为空",disabled:!1},{value:"gt",label:"大于",disabled:!1},{value:"egt",label:"大于等于",disabled:!1},{value:"lt",label:"小于",disabled:!1},{value:"elt",label:"小于等于",disabled:!1}]},fieldChange:function(e){var t=this.fieldList.find(function(t){return t.fieldName===e.fieldName});t&&(e.formType=t.formType,e.name=t.name,"business_type"==e.formType?(e.typeOption=t.setting,e.statusOption=[],e.typeId="",e.statusId=""):"select"==e.formType||"checkStatus"==e.formType?e.setting=t.setting||[]:"date"!==e.formType&&"datetime"!==e.formType&&"user"!==e.formType||(e.value=[])),this.form.filter(function(t){return t.fieldName===e.fieldName}).length>1?this.showErrors=!0:this.showErrors=!1},handleCancel:function(){this.visible=!1,this.$emit("update:dialogVisible",!1)},handleConfirm:function(){if(this.showErrors)this.$message.error("筛选条件中有重复项！");else if(this.saveName&&""!==this.saveName){for(var e=0;e<this.form.length;e++){var t=this.form[e];if(!t.fieldName||""===t.fieldName)return void this.$message.error("要筛选的字段名称不能为空！");if("business_type"==t.formType){if(!t.typeId&&!t.statusId)return void this.$message.error("请输入筛选条件的值！")}else if("date"==t.formType||"datetime"==t.formType||"user"==t.formType){if(!t.value||0===t.value.length)return void this.$message.error("请输入筛选条件的值！")}else if(!t.value)return void this.$message.error("请输入筛选条件的值！")}var i={};this.form.forEach(function(e){"datetime"==e.formType||"date"==e.formType?i[e.fieldName]={start:e.value[0],end:e.value[1],formType:e.formType,name:e.fieldName}:"business_type"==e.formType?i[e.fieldName]={typeId:e.typeId,statusId:e.statusId,formType:e.formType,name:e.fieldName}:"user"==e.formType?i[e.fieldName]={condition:e.condition,value:e.value[0].userId,formType:e.formType,setting:e.value[0],name:e.fieldName}:i[e.fieldName]={condition:e.condition,value:e.value,formType:e.formType,name:e.fieldName}});var s={obj:i,form:this.form,saveDefault:this.saveDefault,saveName:this.saveName};this.requestCreateScene(s)}else this.$message.error("场景名称不能为空！")},requestCreateScene:function(e){var t=this;this.edit_id?Object(d.w)({isDefault:e.saveDefault?1:0,name:e.saveName,sceneId:this.edit_id,data:j()(e.obj)}).then(function(e){t.$message({type:"success",message:"编辑成功"}),t.$emit("saveSuccess"),t.handleCancel()}).catch(function(){}):Object(d.t)({type:o.a[this.crmType],isDefault:e.saveDefault?1:0,name:e.saveName,data:j()(e.obj)}).then(function(e){t.$message({type:"success",message:"创建成功"}),t.$emit("saveSuccess"),t.handleCancel()}).catch(function(){})},handleAdd:function(){this.form.push(this.getItem())},handleDelete:function(e){var t=this;this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.form.splice(e,1)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})}}},z=(i("Gdfm"),Object(b.a)(Z,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:e.edit_id?"编辑场景":"新建场景",visible:e.visible,"append-to-body":!0,width:"800px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[i("div",{staticClass:"scene-name-container"},[i("div",{staticClass:"scene-name"},[e._v("场景名称")]),e._v(" "),i("el-input",{staticClass:"scene-input",attrs:{maxlength:10,placeholder:"请输入场景名称，最多10个字符"},model:{value:e.saveName,callback:function(t){e.saveName="string"==typeof t?t.trim():t},expression:"saveName"}})],1),e._v(" "),i("div",{staticClass:"scene-name"},[e._v("筛选条件")]),e._v(" "),i("el-form",{staticClass:"filter-container",attrs:{id:"scene-filter-container"}},[i("el-form-item",[e._l(e.form,function(t,s){return[i("el-row",{key:s},[i("el-col",{attrs:{span:8}},[i("el-select",{attrs:{placeholder:"请选择要筛选的字段名"},on:{change:function(i){e.fieldChange(t)}},model:{value:t.fieldName,callback:function(i){e.$set(t,"fieldName",i)},expression:"formItem.fieldName"}},e._l(e.fieldList,function(e){return i("el-option",{key:e.fieldName,attrs:{label:e.name,value:e.fieldName}})}))],1),e._v(" "),"date"!==t.formType&&"datetime"!==t.formType&&"business_type"!==t.formType?i("el-col",{attrs:{span:1}},[e._v(" ")]):e._e(),e._v(" "),"date"!==t.formType&&"datetime"!==t.formType&&"business_type"!==t.formType?i("el-col",{attrs:{span:4}},[i("el-select",{attrs:{placeholder:"请选择范围"},model:{value:t.condition,callback:function(i){e.$set(t,"condition",i)},expression:"formItem.condition"}},e._l(e.calConditionOptions(t.formType,t),function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1):e._e(),e._v(" "),"business_type"==t.formType?i("el-col",{attrs:{span:1}},[e._v(" ")]):e._e(),e._v(" "),"business_type"==t.formType?i("el-col",{attrs:{span:4}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:function(i){e.typeOptionsChange(t)}},model:{value:t.typeId,callback:function(i){e.$set(t,"typeId",i)},expression:"formItem.typeId"}},e._l(t.typeOption,function(e){return i("el-option",{key:e.typeId,attrs:{label:e.name,value:e.typeId}})}))],1):e._e(),e._v(" "),i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:"datetime"===t.formType||"date"===t.formType?13:8}},["select"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.setting,function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})):"checkStatus"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.setting,function(e){return i("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})):"date"===t.formType||"datetime"===t.formType?i("el-date-picker",{staticStyle:{padding:"0px 10px"},attrs:{"value-format":"date"===t.formType?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",type:"date"===t.formType?"daterange":"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"business_type"===t.formType?i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.statusId,callback:function(i){e.$set(t,"statusId",i)},expression:"formItem.statusId"}},e._l(t.statusOption,function(e){return i("el-option",{key:e.statusId,attrs:{label:e.name,value:e.statusId}})})):"user"===t.formType?i("xh-user-cell",{attrs:{item:t,value:t.value},on:{"value-change":e.userValueChange}}):i("el-input",{attrs:{placeholder:"请输入筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})],1),e._v(" "),i("el-col",{staticClass:"delete",attrs:{span:1}},[i("i",{staticClass:"el-icon-error delete-btn",on:{click:function(t){e.handleDelete(s)}}})])],1)]})],2)],1),e._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:e.showErrors,expression:"showErrors"}],staticClass:"el-icon-warning warning-info"},[i("span",{staticClass:"desc"},[e._v("筛选条件中有重复项！")])]),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:e.handleAdd}},[e._v("+ 添加筛选条件")]),e._v(" "),i("div",{staticClass:"save"},[i("div",{staticClass:"save-setting"},[i("el-checkbox",{model:{value:e.saveDefault,callback:function(t){e.saveDefault=t},expression:"saveDefault"}},[e._v("设置为默认")])],1)]),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")])],1)],1)},[],!1,null,"40b7f101",null));z.options.__file="SceneCreate.vue";var Y=z.exports,V={name:"SceneSet",components:{draggable:F.a,SceneCreate:Y},props:{dialogVisible:{type:Boolean,required:!0,default:!1},crmType:{type:String,default:""}},data:function(){return{defaultId:"",visible:!1,isleftIndeterminate:!1,checkleftAll:!1,checkedLeftData:[],leftCheckItems:[],isrightIndeterminate:!1,checkrightAll:!1,checkedRightData:[],rightCheckItems:[],moveItem:{},handlDefaultItem:{},showCreateScene:!1,fieldList:[],filterObj:{form:[]},filterName:"",filterDefault:!1,filterEditId:""}},computed:{},watch:{dialogVisible:{handler:function(e){this.visible=e,e&&this.getSceneList()},deep:!0,immediate:!0}},mounted:function(){},methods:{getSceneList:function(){var e=this;Object(d.u)({type:o.a[this.crmType]}).then(function(t){e.checkedLeftData=t.data.value.map(function(e,t){return e.check=!1,e}),e.checkedRightData=t.data.hide_value.map(function(e,t){return e.check=!1,e});var i=e.checkedLeftData.filter(function(e,t){return 1==e.isDefault});i&&i.length>0?e.defaultId=i[0].sceneId:e.defaultId=""}).catch(function(){})},handleConfirm:function(){var e=this,t=this;0==this.checkedLeftData.filter(function(e,i){return e.sceneId==t.defaultId}).length&&(this.defaultId=""),Object(d.v)({type:o.a[this.crmType],noHideIds:this.checkedLeftData.map(function(e,t,i){return e.sceneId}).join(","),hideIds:this.checkedRightData.map(function(e,t,i){return e.sceneId}).join(",")}).then(function(t){e.$message({type:"success",message:"操作成功"}),e.handleCancel(),e.$emit("save-success")}).catch(function(){})},itemHandle:function(e,t,i){var s=this;"edit"==e?this.addAndEditScene("edit",t):"delete"==e?this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(d.r)({sceneId:t.sceneId}).then(function(e){s.$message({type:"success",message:"删除成功"}),s.checkedLeftData.splice(i,1),s.leftCheckItemChange(),s.$emit("save-success")}).catch(function(){})}).catch(function(){s.$message({type:"info",message:"已取消删除"})}):"default"==e&&(this.handlDefaultItem=t)},defaultHandle:function(){var e=this;Object(d.q)({sceneId:this.handlDefaultItem.sceneId}).then(function(t){e.$message({type:"success",message:"操作成功"}),e.defaultId=e.handlDefaultItem.sceneId}).catch(function(){})},addAndEditScene:function(e,t){var i=this;Object(d.C)({label:o.a[this.crmType]}).then(function(s){i.fieldList=s.data,"edit"==e?(i.filterObj={form:[],obj:t.data},i.filterName=t.name,i.filterDefault=1==t.isDefault,i.filterEditId=t.sceneId.toString()):(i.filterObj={form:[]},i.filterEditId="",i.filterName="",i.filterDefault=!1),i.showCreateScene=!0}).catch(function(){})},handleCancel:function(){this.visible=!1,this.$emit("update:dialogVisible",!1)},rightMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},rightMove:function(e){this.moveItem=e.draggedContext.element},leftMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},leftMove:function(e){this.moveItem=e.draggedContext.element},handleleftCheckAllChange:function(e){e&&(this.isleftIndeterminate=!1),this.checkedLeftData=this.checkedLeftData.filter(function(t,i,s){return t.check=e,t}),this.leftCheckItems=e?this.checkedLeftData:[]},leftCheckItemChange:function(){this.leftCheckItems=this.checkedLeftData.filter(function(e,t,i){return 1==e.check}),this.leftCheckItems.length>0?this.leftCheckItems.length==this.checkedLeftData.length?(this.checkleftAll=!0,this.isleftIndeterminate=!1):(this.checkleftAll=!1,this.isleftIndeterminate=!0):(this.checkleftAll=!1,this.isleftIndeterminate=!1)},handlerightCheckAllChange:function(e){e&&(this.isrightIndeterminate=!1),this.checkedRightData=this.checkedRightData.filter(function(t,i,s){return t.check=e,t}),this.rightCheckItems=e?this.checkedRightData:[]},rightCheckItemChange:function(){this.rightCheckItems=this.checkedRightData.filter(function(e,t,i){return 1==e.check}),this.rightCheckItems.length>0?this.rightCheckItems.length==this.checkedRightData.length?(this.checkrightAll=!0,this.isrightIndeterminate=!1):(this.checkrightAll=!1,this.isrightIndeterminate=!0):(this.checkrightAll=!1,this.isrightIndeterminate=!1)},changePositon:function(e){var t=this;"left"==e?(this.checkedRightData=this.checkedRightData.filter(function(e,i,s){var a=!1;return t.rightCheckItems.forEach(function(t,i){e.sceneId==t.sceneId&&(a=!0)}),!a}),this.rightCheckItems.forEach(function(e,i){e.check=!1,t.checkedLeftData.push(e)}),this.rightCheckItems=[],this.isrightIndeterminate=!1,this.checkrightAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange()):(this.checkedLeftData=this.checkedLeftData.filter(function(e,i,s){var a=!1;return t.leftCheckItems.forEach(function(t,i){e.sceneId==t.sceneId&&(a=!0)}),!a}),this.leftCheckItems.forEach(function(e,i){e.check=!1,t.checkedRightData.push(e)}),this.leftCheckItems=[],this.isleftIndeterminate=!1,this.checkleftAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange())}}},H=(i("J481"),Object(b.a)(V,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,title:"场景管理",width:"700px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[i("div",{staticClass:"scene-name"},[e._v("您可通过拖拽管理标签")]),e._v(" "),i("flexbox",{staticClass:"scene-list"},[i("div",{staticClass:"scene-list-box"},[i("flexbox",{staticClass:"scene-list-head"},[i("el-checkbox",{attrs:{indeterminate:e.isleftIndeterminate},on:{change:e.handleleftCheckAllChange},model:{value:e.checkleftAll,callback:function(t){e.checkleftAll=t},expression:"checkleftAll"}}),e._v(" "),i("div",{staticClass:"scene-list-head-name"},[e._v("显示的标签")]),e._v(" "),i("div",{staticClass:"scene-list-head-detail"},[e._v(e._s(e.leftCheckItems.length+"/"+e.checkedLeftData.length))])],1),e._v(" "),i("div",{staticClass:"scene-list-body"},[e._l(e.checkedLeftData,function(t,s){return 1==t.isSystem?i("flexbox",{key:s,staticClass:"list-item"},[i("div",{staticClass:"default-mark",class:{"default-mark-active":t.sceneId==e.defaultId}}),e._v(" "),i("el-checkbox",{staticClass:"list-item-check",attrs:{disabled:!0},on:{change:e.leftCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))]),e._v(" "),i("div",{staticClass:"list-item-handle"},[i("el-dropdown",{attrs:{trigger:"click"},on:{command:e.defaultHandle}},[i("i",{staticClass:"el-icon-arrow-down",on:{click:function(i){e.itemHandle("default",t,s)}}}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[e._v("设置为默认标签")])],1)],1)],1)],1):e._e()}),e._v(" "),i("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.leftMove,options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle"}},on:{end:e.leftMoveEnd},model:{value:e.checkedLeftData,callback:function(t){e.checkedLeftData=t},expression:"checkedLeftData"}},e._l(e.checkedLeftData,function(t,s){return 1!=t.isSystem?i("flexbox",{key:s,staticClass:"list-item"},[i("div",{staticClass:"default-mark",class:{"default-mark-active":t.sceneId==e.defaultId}}),e._v(" "),i("el-checkbox",{staticClass:"list-item-check",on:{change:e.leftCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))]),e._v(" "),i("div",{staticClass:"list-item-handle"},[i("i",{staticClass:"el-icon-edit",on:{click:function(i){e.itemHandle("edit",t,s)}}}),e._v(" "),i("i",{staticClass:"el-icon-delete",on:{click:function(i){e.itemHandle("delete",t,s)}}}),e._v(" "),i("el-dropdown",{on:{command:e.defaultHandle}},[i("i",{staticClass:"el-icon-arrow-down",on:{click:function(i){e.itemHandle("default",t,s)}}}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[e._v("设置为默认标签")])],1)],1)],1)],1):e._e()}))],2)],1),e._v(" "),i("div",{staticClass:"scene-middle-list"},[i("el-button",{staticClass:"scene-middle-left-button",class:{"scene-middle-button-select":e.rightCheckItems.length>0},attrs:{disabled:0==e.rightCheckItems.length},on:{click:function(t){e.changePositon("left")}}},[i("i",{staticClass:"el-icon-arrow-left scene-middle-icon"})]),e._v(" "),i("el-button",{staticClass:"scene-middle-right-button",class:{"scene-middle-button-select":e.leftCheckItems.length>0},attrs:{disabled:0==e.leftCheckItems.length},on:{click:function(t){e.changePositon("right")}}},[i("i",{staticClass:"el-icon-arrow-right scene-middle-icon"})])],1),e._v(" "),i("div",{staticClass:"scene-list-box"},[i("flexbox",{staticClass:"scene-list-head"},[i("el-checkbox",{attrs:{indeterminate:e.isrightIndeterminate},on:{change:e.handlerightCheckAllChange},model:{value:e.checkrightAll,callback:function(t){e.checkrightAll=t},expression:"checkrightAll"}}),e._v(" "),i("div",{staticClass:"scene-list-head-name"},[e._v("隐藏的标签")]),e._v(" "),i("div",{staticClass:"scene-list-head-detail"},[e._v(e._s(e.rightCheckItems.length+"/"+e.checkedRightData.length))])],1),e._v(" "),i("div",{staticClass:"scene-list-body"},[i("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.rightMove,options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle"}},on:{end:e.rightMoveEnd},model:{value:e.checkedRightData,callback:function(t){e.checkedRightData=t},expression:"checkedRightData"}},e._l(e.checkedRightData,function(t,s){return i("flexbox",{key:s,staticClass:"list-item"},[i("el-checkbox",{staticClass:"list-item-check",staticStyle:{"margin-left":"9px"},on:{change:e.rightCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))])],1)}))],1)],1)]),e._v(" "),i("div",{staticClass:"handle-bar"},[i("div",{staticClass:"handle-bar-add",on:{click:function(t){e.addAndEditScene("add",{})}}},[e._v("+ 新建场景")]),e._v(" "),i("div",{staticClass:"handle-bar-save"},[i("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleConfirm(t)}}},[e._v("保存")])],1)]),e._v(" "),i("scene-create",{attrs:{"field-list":e.fieldList,"crm-type":e.crmType,"dialog-visible":e.showCreateScene,obj:e.filterObj,name:e.filterName,edit_id:e.filterEditId,"is-default":e.filterDefault},on:{"update:dialogVisible":function(t){e.showCreateScene=t},saveSuccess:e.getSceneList}})],1)},[],!1,null,"149fb12a",null));H.options.__file="SceneSet.vue";var J=H.exports,Q=i("QY39"),W=i("eOzp"),P=i("V47a"),X=i("ZfAJ"),$={name:"CRMTableHead",components:{filterForm:O.a,filterContent:M.a,SceneList:B,TransferHandle:Q.a,TeamsHandle:W.a,AllocHandle:P.a,SceneCreate:Y,SceneSet:J,DealStatusHandle:X.a},props:{title:{type:String,default:""},crmType:{type:String,default:""},isSeas:{type:Boolean,default:!1}},data:function(){return{sceneTypes:[{type:"enter",name:"我负责的"},{type:"out",name:"我"}],sceneType:null,showScene:!1,showFilter:!1,fieldList:[],filterObj:{form:[]},sceneData:{id:"",bydata:"",name:""},showSceneSet:!1,showSceneCreate:!1,sceneFilterObj:{form:[]},selectionList:[],transferDialogShow:!1,teamsDialogShow:!1,teamsTitle:"",allocDialogShow:!1,dealStatusShow:!1}},computed:l()({},Object(c.b)(["crm","CRMConfig"])),watch:{},mounted:function(){},methods:{handleTypeDrop:function(e){this.sceneType=e},showFilterClick:function(){this.getFilterFieldInfo()},getFilterFieldInfo:function(){var e=this;Object(d.C)({label:o.a[this.crmType]}).then(function(t){e.fieldList=t.data,e.showFilter=!0}).catch(function(){})},handleFilter:function(e){var t=this;this.filterObj=e,this.showFilter=!1,e.saveChecked&&Object(d.t)({type:o.a[this.crmType],isDefault:e.saveDefault?1:0,name:e.saveName,data:j()(e.obj)}).then(function(e){t.updateSceneList()}).catch(function(){}),this.$emit("filter",e.obj)},handleDeleteField:function(e){this.filterObj=e.obj,this.$emit("filter",this.filterObj.obj)},sceneSelect:function(e){this.sceneData=e,this.$emit("scene",e)},sceneHandle:function(e){var t=this;"set"==e.type?this.showSceneSet=!0:"add"==e.type&&Object(d.C)({label:o.a[this.crmType]}).then(function(e){t.fieldList=e.data,t.showSceneCreate=!0}).catch(function(){})},updateSceneList:function(){this.$refs.sceneList.getSceneList()},headSelectionChange:function(e){this.selectionList=e},selectionBarClick:function(e){var t=this;if("transfer"==e)this.transferDialogShow=!0;else if("export"==e){var i={};i.ids=this.selectionList.map(function(e){return e[t.crmType+"Id"]}).join(","),i.__export=!0,this.$emit("exportData",i)}else if("transform"==e||"put_seas"==e||"delete"==e||"lock"==e||"unlock"==e||"start"==e||"disable"==e||"get"==e){var s="";"transform"==e?s="确定将这些线索转换为客户吗?":"put_seas"==e?s="确定转移到公海吗?":"delete"==e?s="确定要删除这些数据吗?":"lock"==e?s="确定要锁定这些客户吗？锁定后将不会掉入公海。":"unlock"==e?s="确定要解锁这些客户吗？":"start"==e?s="确定要上架这些产品吗?":"disable"==e?s="确定要下架这些产品吗?":"get"==e&&(s="确定要领取该客户吗?"),this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmHandle(e)}).catch(function(){t.$message({type:"info",message:"已取消操作"})})}else"add_user"==e?(this.teamsTitle="添加团队成员",this.teamsDialogShow=!0):"delete_user"==e?(this.teamsTitle="移除团队成员",this.teamsDialogShow=!0):"alloc"==e?this.allocDialogShow=!0:"deal_status"==e&&(this.dealStatusShow=!0)},confirmHandle:function(e){var t=this;if("lock"===e||"unlock"===e){var i=this.selectionList.map(function(e,t,i){return e.customerId});Object(h.i)({isLock:"lock"===e?"1":"0",ids:i.join(",")}).then(function(i){t.$message({type:"success",message:"操作成功"}),t.$emit("handle",{type:e})}).catch(function(){})}else if("put_seas"===e){i=this.selectionList.map(function(e,t,i){return e.customerId});Object(h.m)({ids:i.join(",")}).then(function(i){t.$message({type:"success",message:"操作成功"}),t.$emit("handle",{type:e})}).catch(function(){})}else if("transform"===e){var s=this.selectionList.map(function(e,t,i){return e.leadsId});Object(u.n)({leadsIds:s.join(",")}).then(function(i){t.$message({type:"success",message:"转化成功"}),t.$emit("handle",{type:e})}).catch(function(){})}else if("start"===e||"disable"===e){var a=this.selectionList.map(function(e,t,i){return e.productId});Object(f.i)({ids:a.join(","),status:"start"===e?"1":"0"}).then(function(i){t.$message({type:"success",message:"操作成功"}),t.$emit("handle",{type:e})}).catch(function(){})}else if("delete"===e){var n=this,l=this.selectionList.map(function(e,t,i){return e[n.crmType+"Id"]});(0,{leads:u.a,customer:h.b,contacts:m.a,business:C.b,contract:k.b,receivables:A.a,product:f.a}[this.crmType])(x()({},this.crmType+"Ids",l.join(","))).then(function(i){t.$message({type:"success",message:"删除成功"}),t.$emit("handle",{type:e})}).catch(function(){})}else if("get"===e){i=this.selectionList.map(function(e,t,i){return e.customerId});Object(h.u)({ids:i.join(",")}).then(function(i){t.$message({type:"success",message:"操作成功"}),t.$emit("handle",{type:e})}).catch(function(){})}},getSelectionHandleItemsInfo:function(){var e={transfer:{name:"转移",type:"transfer",icon:i("W1y5")},transform:{name:"转化为客户",type:"transform",icon:i("rvIm")},export:{name:"导出选中",type:"export",icon:i("bwvB")},delete:{name:"删除",type:"delete",icon:i("NKOo")},put_seas:{name:"放入公海",type:"put_seas",icon:i("tmjI")},lock:{name:"锁定",type:"lock",icon:i("lYrD")},unlock:{name:"解锁",type:"unlock",icon:i("4N2P")},add_user:{name:"添加团队成员",type:"add_user",icon:i("jJjR")},delete_user:{name:"移除团队成员",type:"delete_user",icon:i("svWA")},alloc:{name:"分配",type:"alloc",icon:i("aQEv")},get:{name:"领取",type:"get",icon:i("lF6w")},start:{name:"上架",type:"start",icon:i("yTN1")},disable:{name:"下架",type:"disable",icon:i("disj")},deal_status:{name:"更改成交状态",type:"deal_status",icon:i("6c4z")}};return"leads"==this.crmType?this.forSelectionHandleItems(e,["transfer","transform","export","delete"]):"customer"==this.crmType?this.isSeas?this.forSelectionHandleItems(e,["alloc","get","delete","export"]):this.forSelectionHandleItems(e,["transfer","export","deal_status","put_seas","delete","lock","unlock","add_user","delete_user"]):"contacts"==this.crmType?this.forSelectionHandleItems(e,["transfer","export","delete"]):"business"==this.crmType?this.forSelectionHandleItems(e,["transfer","delete","add_user","delete_user","export"]):"contract"==this.crmType?this.forSelectionHandleItems(e,["transfer","delete","add_user","delete_user","export"]):"receivables"==this.crmType?this.forSelectionHandleItems(e,["delete","export"]):"product"==this.crmType?this.forSelectionHandleItems(e,["start","disable","delete","export"]):void 0},forSelectionHandleItems:function(e,t){for(var i=[],s=0;s<t.length;s++)i.push(e[t[s]]);return i},whetherTypeShowByPermision:function(e){if("transfer"==e)return"transform"!=this.sceneData.bydata&&this.crm[this.crmType].transfer;if("transform"==e)return"transform"!=this.sceneData.bydata&&this.crm[this.crmType].transform;if("export"==e)return this.isSeas?this.crm.pool.excelexport:this.crm[this.crmType].excelexport;if("delete"==e)return this.crm[this.crmType].delete;if("put_seas"==e)return this.crm[this.crmType].putinpool;if("lock"==e||"unlock"==e)return this.crm[this.crmType].lock&&1==this.CRMConfig.customerConfig;if("add_user"==e||"delete_user"==e)return this.crm[this.crmType].teamsave;if("alloc"==e)return this.crm.pool.distribute;if("get"==e)return this.crm.pool.receive;if("start"==e){for(var t=0;t<this.selectionList.length;t++){if("上架"==this.selectionList[t].是否上下架)return!1}return this.crm[this.crmType].status}if("disable"==e){for(var i=0;i<this.selectionList.length;i++){if("下架"==this.selectionList[i].是否上下架)return!1}return this.crm[this.crmType].status}return"deal_status"!=e||this.crm[this.crmType].dealStatus},handleCallBack:function(e){this.$emit("handle",{type:e.type})},getDefaultSceneName:function(){return"leads"==this.crmType?"全部线索":"customer"==this.crmType?"全部客户":"contacts"==this.crmType?"全部联系人":"business"==this.crmType?"全部商机":"contract"==this.crmType?"全部合同":"receivables"==this.crmType?"全部回款":"product"==this.crmType?"全部产品":void 0}}},K=(i("UFBb"),Object(b.a)($,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("flexbox",{directives:[{name:"show",rawName:"v-show",value:0==e.selectionList.length,expression:"selectionList.length == 0"}],staticClass:"th-container"},[e.isSeas?e._e():s("div",[e._v("场景：")]),e._v(" "),e.isSeas?e._e():s("el-popover",{attrs:{trigger:"click","popper-class":"no-padding-popover",width:"150"},model:{value:e.showScene,callback:function(t){e.showScene=t},expression:"showScene"}},[s("flexbox",{attrs:{slot:"reference"},slot:"reference"},[s("div",{staticClass:"condition_title"},[e._v(e._s(e.sceneData.name||e.getDefaultSceneName()))]),e._v(" "),s("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{color:"#777"}})]),e._v(" "),s("scene-list",{ref:"sceneList",attrs:{"crm-type":e.crmType},on:{scene:e.sceneSelect,"scene-handle":e.sceneHandle,"hidden-scene":function(t){e.showScene=!1}}})],1),e._v(" "),s("img",{staticClass:"c-filtrate",style:{"margin-left":e.isSeas?0:"30px"},attrs:{src:i("3gs7")},on:{click:e.showFilterClick}}),e._v(" "),s("div",{staticClass:"condition_title",on:{click:e.showFilterClick}},[e._v("高级筛选")]),e._v(" "),s("filter-form",{attrs:{"field-list":e.fieldList,"dialog-visible":e.showFilter,obj:e.filterObj,"crm-type":e.crmType,"is-seas":e.isSeas},on:{"update:dialogVisible":function(t){e.showFilter=t},filter:e.handleFilter}})],1),e._v(" "),e.selectionList.length>0?s("flexbox",{staticClass:"selection-bar"},[s("div",{staticClass:"selected—title"},[e._v("已选中"),s("span",{staticClass:"selected—count"},[e._v(e._s(e.selectionList.length))]),e._v("项")]),e._v(" "),s("flexbox",{staticClass:"selection-items-box"},e._l(e.getSelectionHandleItemsInfo(),function(t,i){return e.whetherTypeShowByPermision(t.type)?s("flexbox",{key:i,staticClass:"selection-item",nativeOn:{click:function(i){e.selectionBarClick(t.type)}}},[s("img",{staticClass:"selection-item-icon",attrs:{src:t.icon}}),e._v(" "),s("div",{staticClass:"selection-item-name"},[e._v(e._s(t.name))])]):e._e()}))],1):e._e(),e._v(" "),e.filterObj.form&&e.filterObj.form.length>0?s("filter-content",{attrs:{obj:e.filterObj},on:{delete:e.handleDeleteField}}):e._e(),e._v(" "),s("transfer-handle",{attrs:{"crm-type":e.crmType,"selection-list":e.selectionList,"dialog-visible":e.transferDialogShow},on:{"update:dialogVisible":function(t){e.transferDialogShow=t},handle:e.handleCallBack}}),e._v(" "),s("teams-handle",{attrs:{"crm-type":e.crmType,title:e.teamsTitle,"selection-list":e.selectionList,"dialog-visible":e.teamsDialogShow},on:{"update:dialogVisible":function(t){e.teamsDialogShow=t},handle:e.handleCallBack}}),e._v(" "),s("alloc-handle",{attrs:{"crm-type":e.crmType,"selection-list":e.selectionList,"dialog-visible":e.allocDialogShow},on:{"update:dialogVisible":function(t){e.allocDialogShow=t},handle:e.handleCallBack}}),e._v(" "),s("deal-status-handle",{attrs:{"crm-type":e.crmType,"selection-list":e.selectionList,visible:e.dealStatusShow},on:{"update:visible":function(t){e.dealStatusShow=t},handle:e.handleCallBack}}),e._v(" "),s("scene-set",{attrs:{"dialog-visible":e.showSceneSet,"crm-type":e.crmType},on:{"update:dialogVisible":function(t){e.showSceneSet=t},"save-success":e.updateSceneList}}),e._v(" "),s("scene-create",{attrs:{"field-list":e.fieldList,"crm-type":e.crmType,"dialog-visible":e.showSceneCreate,obj:e.sceneFilterObj},on:{"update:dialogVisible":function(t){e.showSceneCreate=t},saveSuccess:e.updateSceneList}})],1)},[],!1,null,"0e465e12",null));K.options.__file="CRMTableHead.vue";var q=K.exports,ee={name:"FieldsSet",components:{draggable:F.a},props:{dialogVisible:{type:Boolean,required:!0,default:!1},crmType:{type:String,default:""},isSeas:{type:Boolean,default:!1}},data:function(){return{visible:!1,isleftIndeterminate:!1,checkleftAll:!1,leftInput:"",checkedLeftData:[],leftCheckItems:[],isrightIndeterminate:!1,checkrightAll:!1,rightInput:"",checkedRightData:[],rightCheckItems:[],moveItem:{},handlDefaultItem:{}}},computed:{},watch:{dialogVisible:{handler:function(e){this.visible=e,e&&0==this.checkedLeftData.length&&0==this.checkedRightData.length&&this.getFieldConfigIndex()},deep:!0,immediate:!0}},mounted:function(){document.body.ondrop=function(e){e.preventDefault(),e.stopPropagation()}},methods:{getFieldConfigIndex:function(){var e=this;Object(d.h)({label:this.isSeas?o.a.pool:o.a[this.crmType]}).then(function(t){e.checkedLeftData=t.data.value.map(function(e,t){return e.check=!1,e.show=!0,e}),e.checkedRightData=t.data.hideValue.map(function(e,t){return e.check=!1,e.show=!0,e})}).catch(function(){})},inputLeftChange:function(e){this.checkedLeftData=this.checkedLeftData.map(function(t,i){return-1!=t.name.indexOf(e)?t.show=!0:t.show=!1,t})},inputRightChange:function(e){this.checkedRightData=this.checkedRightData.map(function(t,i){return-1!=t.name.indexOf(e)?t.show=!0:t.show=!1,t})},handleConfirm:function(){var e=this;this.checkedLeftData.length<2?this.$message.error("至少要显示两列"):Object(d.g)({label:this.isSeas?o.a.pool:o.a[this.crmType],noHideIds:this.checkedLeftData.map(function(e){return e.id}).join(","),hideIds:this.checkedRightData.map(function(e){return e.id}).join(",")}).then(function(t){e.$message.success("操作成功"),e.$emit("set-success"),e.handleCancel()}).catch(function(){})},handleCancel:function(){this.visible=!1,this.$emit("update:dialogVisible",!1)},rightMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},rightMove:function(e){this.moveItem=e.draggedContext.element},leftMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},leftMove:function(e){this.moveItem=e.draggedContext.element},handleleftCheckAllChange:function(e){e&&(this.isleftIndeterminate=!1),this.checkedLeftData=this.checkedLeftData.filter(function(t,i,s){return t.check=e,t}),this.leftCheckItems=e?this.checkedLeftData:[]},leftCheckItemChange:function(){this.leftCheckItems=this.checkedLeftData.filter(function(e,t,i){return 1==e.check}),this.leftCheckItems.length>0?this.leftCheckItems.length==this.checkedLeftData.length?(this.checkleftAll=!0,this.isleftIndeterminate=!1):(this.checkleftAll=!1,this.isleftIndeterminate=!0):(this.checkleftAll=!1,this.isleftIndeterminate=!1)},handlerightCheckAllChange:function(e){e&&(this.isrightIndeterminate=!1),this.checkedRightData=this.checkedRightData.filter(function(t,i,s){return t.check=e,t}),this.rightCheckItems=e?this.checkedRightData:[]},rightCheckItemChange:function(){this.rightCheckItems=this.checkedRightData.filter(function(e,t,i){return 1==e.check}),this.rightCheckItems.length>0?this.rightCheckItems.length==this.checkedRightData.length?(this.checkrightAll=!0,this.isrightIndeterminate=!1):(this.checkrightAll=!1,this.isrightIndeterminate=!0):(this.checkrightAll=!1,this.isrightIndeterminate=!1)},changePositon:function(e){var t=this;"left"==e?(this.checkedRightData=this.checkedRightData.filter(function(e,i,s){var a=!1;return t.rightCheckItems.forEach(function(t,i){e.id==t.id&&(a=!0)}),!a}),this.rightCheckItems.forEach(function(e,i){e.check=!1,t.checkedLeftData.push(e)}),this.rightCheckItems=[],this.isrightIndeterminate=!1,this.checkrightAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange()):(this.checkedLeftData=this.checkedLeftData.filter(function(e,i,s){var a=!1;return t.leftCheckItems.forEach(function(t,i){e.id==t.id&&(a=!0)}),!a}),this.leftCheckItems.forEach(function(e,i){e.check=!1,t.checkedRightData.push(e)}),this.leftCheckItems=[],this.isleftIndeterminate=!1,this.checkleftAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange())}}},te=(i("ff4y"),Object(b.a)(ee,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,title:"编辑列",width:"600px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[i("div",{staticClass:"scene-name"},[e._v("您可通过拖拽管理列")]),e._v(" "),i("flexbox",{staticClass:"scene-list"},[i("div",{staticClass:"scene-list-box"},[i("flexbox",{staticClass:"scene-list-head"},[i("el-checkbox",{attrs:{indeterminate:e.isleftIndeterminate},on:{change:e.handleleftCheckAllChange},model:{value:e.checkleftAll,callback:function(t){e.checkleftAll=t},expression:"checkleftAll"}}),e._v(" "),i("div",{staticClass:"scene-list-head-name"},[e._v("显示的列")]),e._v(" "),i("div",{staticClass:"scene-list-head-detail"},[e._v(e._s(e.leftCheckItems.length+"/"+e.checkedLeftData.length))])],1),e._v(" "),i("div",{staticStyle:{position:"relative"}},[i("div",{staticClass:"scene-list-search"},[i("el-input",{attrs:{placeholder:"请输入",size:"small","suffix-icon":"el-icon-search"},on:{input:e.inputLeftChange},model:{value:e.leftInput,callback:function(t){e.leftInput=t},expression:"leftInput"}})],1),e._v(" "),i("div",{staticClass:"scene-list-body"},[i("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.leftMove,options:{group:"list",forceFallback:!0}},on:{end:e.leftMoveEnd},model:{value:e.checkedLeftData,callback:function(t){e.checkedLeftData=t},expression:"checkedLeftData"}},e._l(e.checkedLeftData,function(t,s){return t.show?i("flexbox",{key:s,staticClass:"list-item"},[i("el-checkbox",{staticClass:"list-item-check",on:{change:e.leftCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))])],1):e._e()}))],1)])],1),e._v(" "),i("div",{staticClass:"scene-middle-list"},[i("el-button",{staticClass:"scene-middle-left-button",class:{"scene-middle-button-select":e.rightCheckItems.length>0},attrs:{disabled:0==e.rightCheckItems.length},on:{click:function(t){e.changePositon("left")}}},[i("i",{staticClass:"el-icon-arrow-left scene-middle-icon"})]),e._v(" "),i("el-button",{staticClass:"scene-middle-right-button",class:{"scene-middle-button-select":e.leftCheckItems.length>0},attrs:{disabled:0==e.leftCheckItems.length},on:{click:function(t){e.changePositon("right")}}},[i("i",{staticClass:"el-icon-arrow-right scene-middle-icon"})])],1),e._v(" "),i("div",{staticClass:"scene-list-box"},[i("flexbox",{staticClass:"scene-list-head"},[i("el-checkbox",{attrs:{indeterminate:e.isrightIndeterminate},on:{change:e.handlerightCheckAllChange},model:{value:e.checkrightAll,callback:function(t){e.checkrightAll=t},expression:"checkrightAll"}}),e._v(" "),i("div",{staticClass:"scene-list-head-name"},[e._v("隐藏的列")]),e._v(" "),i("div",{staticClass:"scene-list-head-detail"},[e._v(e._s(e.rightCheckItems.length+"/"+e.checkedRightData.length))])],1),e._v(" "),i("div",{staticStyle:{position:"relative"}},[i("div",{staticClass:"scene-list-body"},[i("div",{staticClass:"scene-list-search"},[i("el-input",{attrs:{placeholder:"请输入",size:"small","suffix-icon":"el-icon-search"},on:{input:e.inputRightChange},model:{value:e.rightInput,callback:function(t){e.rightInput=t},expression:"rightInput"}})],1),e._v(" "),i("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.rightMove,options:{group:"list",forceFallback:!0}},on:{end:e.rightMoveEnd},model:{value:e.checkedRightData,callback:function(t){e.checkedRightData=t},expression:"checkedRightData"}},e._l(e.checkedRightData,function(t,s){return t.show?i("flexbox",{key:s,staticClass:"list-item"},[i("el-checkbox",{staticClass:"list-item-check",on:{change:e.rightCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))])],1):e._e()}))],1)])],1)]),e._v(" "),i("div",{staticClass:"handle-bar"},[i("div",{staticClass:"handle-bar-save"},[i("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleConfirm(t)}}},[e._v("保存")])],1)])],1)},[],!1,null,"21662ce7",null));te.options.__file="FieldsSet.vue";var ie=te.exports,se=i("vgcj"),ae=i.n(se),ne=i("vqCa");t.a={components:{CRMListHead:R,CRMTableHead:q,FieldsSet:ie},data:function(){return{loading:!1,tableHeight:document.documentElement.clientHeight-240,list:[],fieldList:[],sortData:{},currentPage:1,pageSize:ae.a.get("crmPageSizes")||15,pageSizes:[15,30,60,100],total:0,search:"",rowID:"",rowType:"",showDview:!1,filterObj:{},sceneId:"",sceneName:"",showFieldSet:!1,selectionList:[],formatterRules:{}}},computed:l()({},Object(c.b)(["crm"])),mounted:function(){var e=this;window.onresize=function(){e.updateTableHeight()},this.isSeas&&this.crm.pool.index?this.getFieldList():this.crm[this.crmType].index&&(this.loading=!0)},methods:{getList:function(){var e=this;this.loading=!0;var t=this.getIndexRequest(),i={page:this.currentPage,limit:this.pageSize,search:this.search,type:this.isSeas?o.a.pool:o.a[this.crmType]};this.sortData.order&&(i.sortField=this.sortData.prop,i.order="ascending"==this.sortData.order?2:1),this.sceneId&&(i.sceneId=this.sceneId),this.filterObj&&a()(this.filterObj).length>0&&(i.data=this.filterObj),t(i).then(function(t){"customer"===e.crmType?e.list=t.data.list.map(function(e){return 1===e.dealStatus?e.dealStatus="已成交":e.dealStatus="未成交",e.show=!1,e}):("contract"===e.crmType&&(e.moneyData=t.data.money),e.list=t.data.list),e.total=t.data.totalRow,e.loading=!1}).catch(function(){e.loading=!1})},getIndexRequest:function(){return"leads"===this.crmType?u.f:"customer"===this.crmType?this.isSeas?h.j:h.h:"contacts"===this.crmType?m.f:"business"===this.crmType?C.e:"contract"===this.crmType?k.e:"product"===this.crmType?f.f:"receivables"===this.crmType?A.d:void 0},getFieldList:function(){var e=this;0==this.fieldList.length?(this.loading=!0,Object(d.A)({label:this.isSeas?o.a.pool:o.a[this.crmType]}).then(function(t){for(var i=0;i<t.data.length;i++){var s=t.data[i],a=0;a=s.width?s.width:s.name&&s.name.length<=6?15*s.name.length+45:140,"floatnumber"===s.formType&&(e.formatterRules[s.fieldName]={type:"floatnumber",formatter:function(e){return Object(v.j)(e)}}),e.fieldList.push({prop:s.fieldName,label:s.name,width:a})}e.getList()}).catch(function(){e.loading=!1})):this.getList()},fieldFormatter:function(e,t){var i=this.formatterRules[t.property];return i?i.formatter(e[t.property]):e[t.property]||"--"},crmSearch:function(e){this.currentPage=1,this.search=e,this.fieldList.length&&this.getList()},handleRowClick:function(e,t,i){if("selection"!==t.type)if("leads"===this.crmType)"leadsName"===t.property?(this.rowID=e.leadsId,this.showDview=!0):this.showDview=!1;else if("customer"===this.crmType){if("businessCheck"===t.property&&e.businessCount>0)return;"customerName"===t.property?(this.rowID=e.customerId,this.rowType="customer",this.showDview=!0):this.showDview=!1}else"contacts"===this.crmType?"customerName"===t.property?(this.rowID=e.customerId,this.rowType="customer",this.showDview=!0):"name"===t.property?(this.rowID=e.contactsId,this.rowType="contacts",this.showDview=!0):this.showDview=!1:"business"===this.crmType?"customerName"===t.property?(this.rowID=e.customerId,this.rowType="customer",this.showDview=!0):"businessName"===t.property?(this.rowID=e.businessId,this.rowType="business",this.showDview=!0):this.showDview=!1:"contract"===this.crmType?"customerName"===t.property?(this.rowID=e.customerId,this.rowType="customer",this.showDview=!0):"businessName"===t.property?(this.rowID=e.businessId,this.rowType="business",this.showDview=!0):"contactsName"===t.property?(this.rowID=e.contactsId,this.rowType="contacts",this.showDview=!0):"num"===t.property?(this.rowID=e.contractId,this.rowType="contract",this.showDview=!0):this.showDview=!1:"product"===this.crmType?"name"===t.property?(this.rowID=e.productId,this.showDview=!0):this.showDview=!1:"receivables"===this.crmType&&("customerName"===t.property?(this.rowID=e.customerId,this.rowType="customer",this.showDview=!0):"contractNum"===t.property?(this.rowID=e.contractId,this.rowType="contract",this.showDview=!0):"number"===t.property?(this.rowID=e.receivablesId,this.rowType="receivables",this.showDview=!0):this.showDview=!1)},exportInfos:function(){var e={search:this.search};this.sceneId&&(e.sceneId=this.sceneId),this.filterObj&&a()(this.filterObj).length>0&&(e.data=this.filterObj);var t=void 0;t=this.isSeas?h.k:{customer:h.e,leads:u.c,contacts:m.c,product:f.c}[this.crmType];var i=ne.Loading.service({fullscreen:!0,text:"导出中..."});t(e).then(function(e){var t=new Blob([e.data],{type:"application/vnd.ms-excel;charset=utf-8"}),s=document.createElement("a"),a=window.URL.createObjectURL(t);s.href=a,s.download=decodeURI(e.headers["content-disposition"].split("filename=")[1])||"",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a),i.close()}).catch(function(){i.close()})},handleFilter:function(e){this.filterObj=e;var t=document.documentElement.clientHeight,i=a()(this.filterObj).length>0?310:240;this.tableHeight=t-i,this.currentPage=1,this.getList()},handleScene:function(e){this.sceneId=e.id,this.sceneName=e.name,this.currentPage=1,this.getFieldList()},handleHandle:function(e){"alloc"!==e.type&&"get"!==e.type&&"transfer"!==e.type&&"transform"!==e.type&&"delete"!==e.type&&"put_seas"!==e.type||(this.showDview=!1),"edit"!==e.type&&this.getList()},setSave:function(){this.fieldList=[],this.getFieldList()},listHeadHandle:function(e){"save-success"===e.type&&(this.currentPage=1,this.getList())},handleTableSet:function(){this.showFieldSet=!0},sortChange:function(e,t,i){this.currentPage=1,this.sortData=e,this.getList()},handleSelectionChange:function(e){this.selectionList=e,this.$refs.crmTableHead.headSelectionChange(e)},handleHeaderDragend:function(e,t,i,s){if(i.property){var a=this.isSeas?this.crmType+"_pool":this.crmType;Object(d.f)({types:"crm_"+a,field:i.property,width:e}).then(function(e){}).catch(function(){})}},handleSizeChange:function(e){ae.a.set("crmPageSizes",e),this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},getStatusStyle:function(e){return 0==e?{"border-color":"#E6A23C","background-color":"#FDF6EC",color:"#E6A23C"}:3==e?{"border-color":"#409EFF","background-color":"#ECF5FF",color:"#409EFF"}:1==e?{"border-color":"#67C23A","background-color":"#F0F9EB",color:"#67C23A"}:2==e?{"border-color":"#F56C6B","background-color":"#FEF0F0",color:"#F56C6B"}:4==e||5==e?{"background-color":"#FFFFFF"}:6==e?{"border-color":"#E9E9EB","background-color":"#F4F4F5",color:"#909399"}:void 0},getStatusName:function(e){return 0==e?"待审核":1==e?"通过":2==e?"拒绝":3==e?"审核中":4==e?"撤回":5==e?"未提交":6==e?"已作废":""},updateTableHeight:function(){var e=document.documentElement.clientHeight,t=a()(this.filterObj).length>0?310:240;this.tableHeight=e-t},exportData:function(e){this.$refs.listHead.handleTypeDrop("out",e)}},beforeDestroy:function(){}}},oWS4:function(e,t,i){"use strict";var s=i("7Qib"),a=i("8GhS"),n=i("0rRK"),l=i.n(n),c={name:"Index",components:{XhUserCell:a.p,XhProuctCate:a.j,VDistpicker:l.a},props:{dialogVisible:{type:Boolean,required:!0,default:!1},fieldList:{type:Array,required:!0,default:function(){return[]}},obj:{type:Object,required:!0,default:function(){return{}}},crmType:{type:String,default:""},isSeas:{type:Boolean,default:!1}},data:function(){return{form:[],visible:!1,showErrors:!1,saveChecked:!1,saveDefault:!1,saveName:null}},watch:{dialogVisible:{handler:function(e){e&&(this.form=Object(s.k)(this.obj.form),0==this.form.length&&this.form.push({fieldName:"",name:"",formType:"",condition:"is",value:"",typeOption:[],statusOption:[],typeId:"",statusId:"",address:{state:"",city:"",area:""}}),this.saveChecked=!1,this.saveDefault=!1,this.saveName=null),this.visible=this.dialogVisible},deep:!0,immediate:!0},form:function(){this.$nextTick(function(){var e=document.getElementById("filter-container");e.scrollTop=e.scrollHeight})}},methods:{selectProvince:function(e,t){t.address.state=e.value},selectCity:function(e,t){t.address.city=e.value},selectArea:function(e,t){t.address.area=e.value},typeOptionsChange:function(e){if(e.typeId){var t=e.typeOption.find(function(t){return t.typeId===e.typeId});e.statusOption=t.statusList||[]}else e.statusOption=[];e.statusId=""},arrayValueChange:function(e){e.value.length>0?(e.item.value=e.value,e.item.valueContent=e.valueContent):e.item.value=[]},showCalCondition:function(e){return"date"!=e&&"datetime"!=e&&"business_type"!=e&&"category"!=e&&"map_address"!=e},calConditionOptions:function(e,t){return"select"==e||"checkbox"==e||"user"==e||"checkStatus"==e?[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1}]:"module"==e||"text"==e||"textarea"==e?[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"notContains",label:"不包含",disabled:!1}]:"floatnumber"==e||"number"==e?[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"notContains",label:"不包含",disabled:!1},{value:"isNull",label:"为空",disabled:!1},{value:"isNotNull",label:"不为空",disabled:!1},{value:"gt",label:"大于",disabled:!1},{value:"egt",label:"大于等于",disabled:!1},{value:"lt",label:"小于",disabled:!1},{value:"elt",label:"小于等于",disabled:!1}]:"category"==e?[{value:"is",label:"等于",disabled:!1},{value:"isnot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"not_contain",label:"不包含",disabled:!1}]:[{value:"is",label:"等于",disabled:!1},{value:"isNot",label:"不等于",disabled:!1},{value:"contains",label:"包含",disabled:!1},{value:"notContains",label:"不包含",disabled:!1},{value:"startWith",label:"开始于",disabled:!1},{value:"endWith",label:"结束于",disabled:!1},{value:"isNull",label:"为空",disabled:!1},{value:"isNotNull",label:"不为空",disabled:!1},{value:"gt",label:"大于",disabled:!1},{value:"egt",label:"大于等于",disabled:!1},{value:"lt",label:"小于",disabled:!1},{value:"elt",label:"小于等于",disabled:!1}]},fieldChange:function(e){var t=this.fieldList.find(function(t){return t.fieldName===e.fieldName});t&&(e.formType=t.formType,e.name=t.name,"business_type"==e.formType?(e.typeOption=t.setting,e.statusOption=[],e.typeId="",e.statusId="",e.value=""):"select"==e.formType||"checkStatus"==e.formType?(e.setting=t.setting||[],e.value=""):"map_address"==e.formType?e.address={state:"",city:"",area:""}:"date"===e.formType||"datetime"===e.formType||"user"===e.formType||"category"===e.formType?e.value=[]:e.value=""),this.form.filter(function(t){return t.fieldName===e.fieldName}).length>1?this.showErrors=!0:this.showErrors=!1},handleCancel:function(){this.$emit("update:dialogVisible",!1)},handleConfirm:function(){if(this.showErrors)this.$message.error("筛选条件中有重复项！");else if(!this.saveChecked||this.saveName&&""!==this.saveName){for(var e=0;e<this.form.length;e++){var t=this.form[e];if(!t.fieldName||""===t.fieldName)return void this.$message.error("要筛选的字段名称不能为空！");if("business_type"==t.formType){if(!t.typeId&&!t.statusId)return void this.$message.error("请输入筛选条件的值！")}else if("map_address"==t.formType){if(!t.address.state&&!t.address.city&&!t.address.area)return void this.$message.error("请选择筛选条件的值！")}else if("date"==t.formType||"datetime"==t.formType||"user"==t.formType||"category"==t.formType){if(!t.value||0===t.value.length)return void this.$message.error("请选择筛选条件的值！")}else if(!t.value&&0!==t.value)return void this.$message.error("请输入筛选条件的值！")}var i={};this.form.forEach(function(e){if("datetime"==e.formType||"date"==e.formType)i[e.fieldName]={start:e.value[0],end:e.value[1],formType:e.formType,name:e.fieldName};else if("business_type"==e.formType)i[e.fieldName]={typeId:e.typeId,statusId:e.statusId,formType:e.formType,name:e.fieldName};else if("user"==e.formType)i[e.fieldName]={condition:e.condition,value:e.value[0].userId,formType:e.formType,name:e.fieldName};else if("category"==e.formType)i[e.fieldName]={condition:"is",value:e.value[e.value.length-1],formType:e.formType,name:e.fieldName};else if("map_address"==e.formType){var t="";for(var s in e.address)e.address[s]&&(t+=e.address[s]+",");i[e.fieldName]={value:t,formType:e.formType,name:e.fieldName}}else i[e.fieldName]={condition:e.condition,value:e.value,formType:e.formType,name:e.fieldName}});var s={obj:i,form:this.form,saveChecked:this.saveChecked,saveDefault:this.saveDefault,saveName:this.saveName};this.$emit("filter",s)}else this.$message.error("场景名称不能为空！")},handleAdd:function(){this.form.push({fieldName:"",condition:"is",value:"",formType:"",setting:[],typeOption:[],statusOption:[],typeId:"",statusId:""})},handleDelete:function(e){var t=this;this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.form.splice(e,1)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})}}},o=(i("yLRg"),i("ZrdR")),r=Object(o.a)(c,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,title:"高级筛选",width:"900px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[i("div",{staticStyle:{"margin-bottom":"10px"}},[e._v("筛选条件")]),e._v(" "),i("el-form",{staticClass:"filter-container",attrs:{id:"filter-container"}},[i("el-form-item",[e._l(e.form,function(t,s){return[i("el-row",{key:s},[i("el-col",{attrs:{span:8}},[i("el-select",{attrs:{placeholder:"请选择要筛选的字段名"},on:{change:function(i){e.fieldChange(t)}},model:{value:t.fieldName,callback:function(i){e.$set(t,"fieldName",i)},expression:"formItem.fieldName"}},e._l(e.fieldList,function(e){return i("el-option",{key:e.fieldName,attrs:{label:e.name,value:e.fieldName}})}))],1),e._v(" "),e.showCalCondition(t.formType)?i("el-col",{attrs:{span:1}},[e._v(" ")]):e._e(),e._v(" "),e.showCalCondition(t.formType)?i("el-col",{attrs:{span:4}},[i("el-select",{attrs:{placeholder:"请选择范围"},model:{value:t.condition,callback:function(i){e.$set(t,"condition",i)},expression:"formItem.condition"}},e._l(e.calConditionOptions(t.formType,t),function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1):e._e(),e._v(" "),"business_type"==t.formType?i("el-col",{attrs:{span:1}},[e._v(" ")]):e._e(),e._v(" "),"business_type"==t.formType?i("el-col",{attrs:{span:4}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:function(i){e.typeOptionsChange(t)}},model:{value:t.typeId,callback:function(i){e.$set(t,"typeId",i)},expression:"formItem.typeId"}},e._l(t.typeOption,function(e){return i("el-option",{key:e.typeId,attrs:{label:e.name,value:e.typeId}})}))],1):e._e(),e._v(" "),i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:"datetime"===t.formType||"date"===t.formType||"map_address"===t.formType?13:8}},["select"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.setting,function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})):"checkStatus"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.setting,function(e){return i("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})):"date"===t.formType||"datetime"===t.formType?i("el-date-picker",{staticStyle:{padding:"0px 10px"},attrs:{"value-format":"date"===t.formType?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",type:"date"===t.formType?"daterange":"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"business_type"===t.formType?i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.statusId,callback:function(i){e.$set(t,"statusId",i)},expression:"formItem.statusId"}},e._l(t.statusOption,function(e){return i("el-option",{key:e.statusId,attrs:{label:e.name,value:e.statusId}})})):"user"===t.formType?i("xh-user-cell",{attrs:{item:t,"info-params":{m:"crm",c:e.crmType,a:"index"}},on:{"value-change":e.arrayValueChange}}):"category"===t.formType?i("xh-prouct-cate",{attrs:{item:t},on:{"value-change":e.arrayValueChange}}):"map_address"===t.formType?i("v-distpicker",{attrs:{province:t.address.state,city:t.address.city,area:t.address.area},on:{province:function(i){e.selectProvince(i,t)},city:function(i){e.selectCity(i,t)},area:function(i){e.selectArea(i,t)}}}):i("el-input",{attrs:{placeholder:"请输入筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})],1),e._v(" "),i("el-col",{staticClass:"delete",attrs:{span:1}},[i("i",{staticClass:"el-icon-error delete-btn",on:{click:function(t){e.handleDelete(s)}}})])],1)]})],2)],1),e._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:e.showErrors,expression:"showErrors"}],staticClass:"el-icon-warning warning-info"},[i("span",{staticClass:"desc"},[e._v("筛选条件中有重复项！")])]),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:e.handleAdd}},[e._v("+ 添加筛选条件")]),e._v(" "),e.isSeas?e._e():i("div",{staticClass:"save"},[i("el-checkbox",{model:{value:e.saveChecked,callback:function(t){e.saveChecked=t},expression:"saveChecked"}},[e._v("保存为场景")]),e._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:e.saveChecked,expression:"saveChecked"}],staticClass:"name",attrs:{maxlength:10,placeholder:"请输入场景名称，最多10个字符"},model:{value:e.saveName,callback:function(t){e.saveName="string"==typeof t?t.trim():t},expression:"saveName"}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.saveChecked,expression:"saveChecked"}],staticClass:"save-setting"},[i("el-checkbox",{model:{value:e.saveDefault,callback:function(t){e.saveDefault=t},expression:"saveDefault"}},[e._v("设置为默认")])],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")])],1)],1)},[],!1,null,"2df55234",null);r.options.__file="index.vue";t.a=r.exports},ritK:function(e,t,i){},svWA:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkE1NUY2OTMzRjEzRTExRTg4NDAxQkEzQkYwMjU3REExIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkE1NUY2OTM0RjEzRTExRTg4NDAxQkEzQkYwMjU3REExIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QTU1RjY5MzFGMTNFMTFFODg0MDFCQTNCRjAyNTdEQTEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QTU1RjY5MzJGMTNFMTFFODg0MDFCQTNCRjAyNTdEQTEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70mGn0AAABSElEQVR42qyUsUoDQRRFs4tNsFTU2h8QQQQtVPwCm0UtBFE/wCJfIQrBWlBIYWQbDVgqaKEQLGItsRQU00Xtsp6RuyBhXtzFfXB2hpk7l30zbyZIkqRUZAy5TxzH/zaKouinDY15N74ODXiDRG1D49Y678QkNOEAWjKYVtvSeFM6f8p9ZvdwCUvQ7Zu/gj04lG4Onq0/dP0zuIAtj1kaXc2fSx9ahmswAbsZz8HpxrXOa7gBx/CZ0fALTrTOazgDNzmr5RamrEMZVWmkMajiA7WvMGIZvsOYZ9GgcHvYsVJ+gMWcKS/Ao2VYg00oZzQrS1+zDOvak2pGw6r0dWsPe6qpO/Ur8OExGoZ9WIF5ac2r15bI3YAnOIJrHZirgmXYgRfp2n/d5dR0Flb1IGzLrKODqyjNXpbH4Xf6pyJXBEW/2GGp4PgWYAAHtEsSK3MhmAAAAABJRU5ErkJggg=="},"u/aq":function(e,t,i){},unkg:function(e,t,i){},yLRg:function(e,t,i){"use strict";var s=i("UXuX");i.n(s).a},zbTZ:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdGRTgyQUFEQzBBMzExRTg4RTlCRTNDNzA5Q0RDRTJBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjdGRTgyQUFFQzBBMzExRTg4RTlCRTNDNzA5Q0RDRTJBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N0ZFODJBQUJDMEEzMTFFODhFOUJFM0M3MDlDRENFMkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZFODJBQUNDMEEzMTFFODhFOUJFM0M3MDlDRENFMkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7S8sG0AAABaklEQVR42qyUPUsDQRCG94IgGAiagELsU6WxUmITEKwEQYJop6U2/gTxH1gldrFWEASrQDgbP4oDmzR2WqQ4IQiBCAcWviOzsA5zeyf6wtPMx8vu7dwEURQZj7pgT8TOwX5aQ8H4taDE5n0NruG0yDXAstKzwjmj9VrDWfAKQtACl+AOlBXDMueoZod7XtjDTHHRCV+PaJp8ajHG8TiiE9bBofm7yKNOJzx1Tqrpg69IWgUzKXXfXnTCicesD2pgnalxLE0TMtxMufIIbIGhExtybKTUH5CXfeVQKeiBsRIfc04qzDPYv5Y11EaFvllJiZc4J9W0htegoxRUwBVYdGJVjlWU+jPyoqcuem6wBp7F2PjqiwG2DQ32U8Ys5tEnWKIrD0D7H96DPAb2UY5BDG7BLv/4WboA29wTs4cJnAVLKygR6+sGzAmjd7AB7sX6SuQcJqKRGh6Vkz0Isx+9WYMdK7E3X8OXAAMApsZGDBJcTHwAAAAASUVORK5CYII="}}]);